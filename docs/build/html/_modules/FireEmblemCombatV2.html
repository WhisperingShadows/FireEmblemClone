

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>FireEmblemCombatV2 &mdash; FireEmblemClone  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> FireEmblemClone
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Code</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">FireEmblemClone</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>FireEmblemCombatV2</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for FireEmblemCombatV2</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Contains the updated combat logic for FireEmblemClone</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">Code.FEH_DijkstraAlgorithm</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">Code</span> <span class="kn">import</span> <span class="n">StatGrowth</span>
<span class="kn">from</span> <span class="nn">Code.ThreadedLoad_JSON_Data</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">trunc</span><span class="p">,</span> <span class="n">floor</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">metaproperties</span> <span class="kn">import</span> <span class="n">properties</span><span class="p">,</span> <span class="n">self_properties</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">Tools.metaproperties</span> <span class="kn">import</span> <span class="n">properties</span><span class="p">,</span> <span class="n">self_properties</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">Callable</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">utility_functions</span> <span class="kn">import</span> <span class="n">call_with</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">Tools.utility_functions</span> <span class="kn">import</span> <span class="n">call_with</span>

<span class="c1"># TODO: rework loadfile output dicts to use id_nums tag as keys</span>

<span class="c1"># FIXME: change casings</span>
<span class="c1">#: Config dictionary</span>
<span class="n">CONFIG</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;combat_animations&quot;</span><span class="p">:</span> <span class="s2">&quot;off&quot;</span><span class="p">,</span>
    <span class="s2">&quot;support_animations&quot;</span><span class="p">:</span> <span class="s2">&quot;off&quot;</span><span class="p">,</span>
    <span class="s2">&quot;foe/ally autobattle movement&quot;</span><span class="p">:</span> <span class="s2">&quot;simple&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auto-favorite&quot;</span><span class="p">:</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;starting a map&quot;</span><span class="p">:</span> <span class="s2">&quot;go into battle&quot;</span><span class="p">,</span>
    <span class="s2">&quot;smart end&quot;</span><span class="p">:</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
    <span class="s2">&quot;show danger area&quot;</span><span class="p">:</span> <span class="s2">&quot;off&quot;</span><span class="p">,</span>
    <span class="s2">&quot;confirm action&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="s2">&quot;confirm move&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="s2">&quot;double tap to wait&quot;</span><span class="p">:</span> <span class="s2">&quot;off&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auto-battle button&quot;</span><span class="p">:</span> <span class="s2">&quot;all locations&quot;</span><span class="p">,</span>
    <span class="s2">&quot;assist skills in auto&quot;</span><span class="p">:</span> <span class="s2">&quot;no move skills&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auto-battle text&quot;</span><span class="p">:</span> <span class="s2">&quot;auto-advance&quot;</span><span class="p">,</span>
    <span class="s2">&quot;continuous auto&quot;</span><span class="p">:</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
    <span class="s2">&quot;map: no animation&quot;</span><span class="p">:</span> <span class="s2">&quot;off&quot;</span><span class="p">,</span>
    <span class="s2">&quot;auto: no animation&quot;</span><span class="p">:</span> <span class="s2">&quot;off&quot;</span><span class="p">,</span>
    <span class="s2">&quot;forging bonds: skip conversation&quot;</span><span class="p">:</span> <span class="s2">&quot;off&quot;</span><span class="p">,</span>
    <span class="s2">&quot;asset/flaw color display&quot;</span><span class="p">:</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sorting by level&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="s2">&quot;duo hero display&quot;</span><span class="p">:</span> <span class="s2">&quot;full&quot;</span><span class="p">,</span>
    <span class="s2">&quot;no duo skill animation&quot;</span><span class="p">:</span> <span class="s2">&quot;off&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tt difficulty tip&quot;</span><span class="p">:</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lost lore home notification&quot;</span><span class="p">:</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mjolnir&#39;s strike home notification&quot;</span><span class="p">:</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>  <span class="c1"># FIXME: change mjolnir to include diacritics</span>
    <span class="s2">&quot;voting gauntlet home notification&quot;</span><span class="p">:</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
    <span class="s2">&quot;forging bonds home notification&quot;</span><span class="p">:</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
    <span class="s2">&quot;compile CMs home notification&quot;</span><span class="p">:</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AR auto-dispatch home notification&quot;</span><span class="p">:</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
    <span class="s2">&quot;enemy music&quot;</span><span class="p">:</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
    <span class="s2">&quot;battle music&quot;</span><span class="p">:</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
    <span class="s2">&quot;silent mode&quot;</span><span class="p">:</span> <span class="s2">&quot;off&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BGM volume&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s2">&quot;SE volume&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;voice volume&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># TODO: rework for compatibility with FEH maps (ex. initialize from map file or dict of tiles)</span>
<span class="n">GRID</span> <span class="o">=</span> <span class="n">Graph</span><span class="o">.</span><span class="n">init_as_grid</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

<span class="c1"># ============================================================================================================</span>
<span class="c1"># MODULE LEVEL VARIABLE DEFINITIONS START</span>

<span class="c1">#: Weapon advantage definitions where 1, 2, and 3 correspond to red, blue, and green, respectively.</span>
<span class="c1">#: The value of each key represents the color that has advantage against the key.</span>
<span class="n">weapon_advantage</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">}</span>

<span class="c1">#: Module-level variable containing all active units</span>
<span class="n">char_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1">#: Mapping dictionary; maps skill category number to skill type</span>
<span class="n">category_number_to_name_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;weapon&quot;</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;assist&quot;</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;special&quot;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="s2">&quot;seal&quot;</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="s2">&quot;refined weapon skill&quot;</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="s2">&quot;beast transformation&quot;</span>
<span class="p">}</span>

<span class="c1">#: Mapping dictionary; maps skill type to skill category number</span>
<span class="n">category_name_to_number_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">category_number_to_name_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="c1">#: Mapping dictionary; maps stat position to stat name</span>
<span class="n">stat_num_to_name_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;hp&quot;</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;atk&quot;</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;spd&quot;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;def&quot;</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;res&quot;</span>
<span class="p">}</span>


<span class="c1"># MODULE LEVEL VARIABLE DEFINITIONS END</span>
<span class="c1"># ============================================================================================================</span>


<span class="c1"># ============================================================================================================</span>
<span class="c1"># CUSTOM EXCEPTIONS DEFINITIONS START</span>

<div class="viewcode-block" id="SkillIsIncorrectCategoryException"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.SkillIsIncorrectCategoryException">[docs]</a><span class="k">class</span> <span class="nc">SkillIsIncorrectCategoryException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exception raised when a supplied skill is of an incorrect category</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="InvalidWeapon"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.InvalidWeapon">[docs]</a><span class="k">class</span> <span class="nc">InvalidWeapon</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exception raised when attempting to equip a weapon a unit does not have access to</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="LimitIdNotFound"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.LimitIdNotFound">[docs]</a><span class="k">class</span> <span class="nc">LimitIdNotFound</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<span class="c1"># CUSTOM EXCEPTIONS DEFINITIONS END</span>
<span class="c1"># ============================================================================================================</span>


<span class="c1"># ============================================================================================================</span>
<span class="c1"># CLASS DEFINITIONS START</span>

<span class="c1"># TODO: Add these to class definitions for positions</span>
<div class="viewcode-block" id="Point"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Point">[docs]</a><span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to hold character positions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span></div>


<div class="viewcode-block" id="ArbitraryAttributeClass"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.ArbitraryAttributeClass">[docs]</a><span class="k">class</span> <span class="nc">ArbitraryAttributeClass</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Intended for use as a base class to inherit from. Initializes class with attributes</span>
<span class="sd">    given by keyword arguments or a supplied dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: Maybe make values be copies? Might be references that cause problems otherwise</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># print(kwargs)</span>
        <span class="k">if</span> <span class="s2">&quot;input_dict&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;input_dict&quot;</span><span class="p">])</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;input_dict&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;kwargs&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;kwargs&quot;</span><span class="p">])</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># print(key, kwargs[key])</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

<div class="viewcode-block" id="ArbitraryAttributeClass.from_dict"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.ArbitraryAttributeClass.from_dict">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds class from a supplied dictionary and/or list of keyword arguments</span>

<span class="sd">        :param input_dict:</span>
<span class="sd">        :param kwargs:</span>
<span class="sd">        :return: Class with attributes defined by input</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">input_dict</span><span class="o">=</span><span class="n">input_dict</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArbitraryAttributeClass.get_all_attrs"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.ArbitraryAttributeClass.get_all_attrs">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns object dictionary</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span></div></div>


<span class="c1"># I don&#39;t believe this class is necessary</span>
<span class="c1"># class Switch:</span>
<span class="c1">#     @classmethod</span>
<span class="c1">#     def validate_character_attribute(cls, key, value, verbose=False):</span>
<span class="c1">#</span>
<span class="c1">#         # Create default return function</span>
<span class="c1">#         # *args consumes &quot;value&quot; argument</span>
<span class="c1">#         def default(input_value):</span>
<span class="c1">#             if verbose:</span>
<span class="c1">#                 print(&quot;Could not validate value {0} as no validation method exists for {0}, &quot;</span>
<span class="c1">#                       &quot;defaulting to valid&quot;.format(input_value, key))</span>
<span class="c1">#</span>
<span class="c1">#         # Select validation method</span>
<span class="c1">#         method_name = &#39;validate_&#39; + str(key)</span>
<span class="c1">#         # Get the method from &#39;self&#39;. Defaults to default method.</span>
<span class="c1">#         method = getattr(cls, method_name, default)</span>
<span class="c1">#         # Call the method and return result, if no</span>
<span class="c1">#         output = method(value)</span>
<span class="c1">#         if output == 1 or output == 0:</span>
<span class="c1">#             return output</span>
<span class="c1">#         else:</span>
<span class="c1">#             return 1</span>
<span class="c1">#</span>
<span class="c1">#     @staticmethod</span>
<span class="c1">#     def validate_rarity(value):</span>
<span class="c1">#         if isinstance(value, int):</span>
<span class="c1">#             if 1 &lt;= value &lt;= 5:</span>
<span class="c1">#                 return 1</span>
<span class="c1">#         elif value is None:</span>
<span class="c1">#             return 1</span>
<span class="c1">#         return 0</span>
<span class="c1">#</span>
<span class="c1">#     # TODO: Implement merged and high level unit support</span>
<span class="c1">#     @staticmethod</span>
<span class="c1">#     def validate_level(value):</span>
<span class="c1">#         if isinstance(value, int):</span>
<span class="c1">#             if 1 &lt;= value &lt;= 40:</span>
<span class="c1">#                 return 1</span>
<span class="c1">#         elif value is None:</span>
<span class="c1">#             return 1</span>
<span class="c1">#         return 0</span>
<span class="c1">#</span>
<span class="c1">#     @staticmethod</span>
<span class="c1">#     def validate_pos(value):</span>
<span class="c1">#         grid_size = GRID.get_grid_width_height()</span>
<span class="c1">#         if isinstance(value, tuple):</span>
<span class="c1">#             if 1 &lt;= value[0] &lt;= grid_size[0] and 1 &lt;= value[1] &lt;= grid_size[1]:</span>
<span class="c1">#                 return 1</span>
<span class="c1">#         elif value is None:</span>
<span class="c1">#             return 1</span>
<span class="c1">#         return 0</span>
<span class="c1">#</span>
<span class="c1">#     @staticmethod</span>
<span class="c1">#     def validate_move_range(value):</span>
<span class="c1">#         if isinstance(value, int):</span>
<span class="c1">#             if 1 &lt;= value &lt;= 3:</span>
<span class="c1">#                 return 1</span>
<span class="c1">#         elif value is None:</span>
<span class="c1">#             return 1</span>
<span class="c1">#         return 0</span>
<span class="c1">#         pass</span>


<div class="viewcode-block" id="Skill"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Skill">[docs]</a><span class="k">class</span> <span class="nc">Skill</span><span class="p">(</span><span class="n">ArbitraryAttributeClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for :class:`Character` skills. Structure defined by JSON data (not dynamically unfortunately,</span>
<span class="sd">    I wrote it all by hand).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1">#: Full internal string identifier of the skill e.g. SID_ジークリンデ_共 for Sieglinde</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_tag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Internal string identifier of the unrefined version of the weapon e.g. SID_ジークリンデ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refine_base</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Internal string identifier of the skill name resource e.g. MSID_ジークリンデ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Internal string identifier of the skill description resource, e.g. MSID_H_ジークリンデ改</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Internal string identifier of the skill that gives rise to the refined skill effect, e.g. SID_強化共有R</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refine_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Internal string identifier of the skill that activates while the unit is transformed into</span>
        <span class="c1">#: a beast, e.g. SID_化身効果・奥義強化</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beast_effect_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Internal string identifiers of skills required to learn the current skill.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prerequisites</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Internal string identifier of the canonical upgrade of the current skill. It is defined if and only if</span>
        <span class="c1">#: promotion_rarity is not zero.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_skill</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Filenames of the sprites used by the weapon, in this order: bow, weapon / arrow, map animation,</span>
        <span class="c1">#: AoE Special map animation.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sprites</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: Permanent stat bonuses of the skill. For weapons this does not include might.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: A set of extra parameters that are used only for skill effects common to weapon classes</span>
        <span class="c1">#: for which is_staff, is_dagger, is_breath, or is_beast is true:</span>
        <span class="c1">#: - is_staff: If class_params.hp = 1, calculates damage from staff like other weapons.;</span>
        <span class="c1">#:   If class_params.hp = 2, foe cannot counterattack.</span>
        <span class="c1">#: - is_dagger: After combat, if unit attacked, inflicts stat+class_params on target and foes within</span>
        <span class="c1">#:   class_params.hp spaces of target through their next actions.</span>
        <span class="c1">#: - is_breath: If class_params.hp = 1, and if target_mov foe uses target_wep, calculates damage</span>
        <span class="c1">#:   using the lower of foe&#39;s Def or Res.</span>
        <span class="c1">#: - is_beast: If class_params.hp = 1, at start of turn, if unit is adjacent to only beast or</span>
        <span class="c1">#:   dragon allies or if unit is not adjacent to any ally, unit transforms (otherwise, unit reverts);</span>
        <span class="c1">#:   if unit transforms, grants stat+class_params.</span>
        <span class="c1">#: .. note::</span>
        <span class="c1">#:    is_staff, is_dagger, is_breath, and is_beast are currently implemented as</span>
        <span class="c1">#:    Character attributes, not as Weapon attributes or methods</span>
        <span class="c1">#:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_params</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: Various skill parameters packed into a stat tuple. These do not necessarily represent stat values.</span>
        <span class="c1">#: Their meanings depend on the skill abilities.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skill_params</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: Various skill parameters packed into a stat tuple. These do not necessarily represent stat values.</span>
        <span class="c1">#: Their meanings depend on the skill abilities.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skill_params2</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: Stat bonuses of the skill&#39;s refinement, as shown on the weapon description.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refine_stats</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: A unique increasing index for every skill, added to 0x10000000 for refined weapons.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_num</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: The internal sort value used in places such as the skill inheritance menu to order skills within</span>
        <span class="c1">#: the same category according to their skill families.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: The icon index of the skill, referring to the files UI/Skill_Passive*.png.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icon_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: A bitmask indexed by weapon_index, with bits set for weapon classes that can equip the current skill.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wep_equip</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: A bitmask indexed by move_index, with bits set for movement classes that can equip the current skill.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mov_equip</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: SP required to learn the given skill.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sp_cost</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: | Category of the skill.</span>
        <span class="c1">#: | 0	0xBC	Weapon</span>
        <span class="c1">#: | 1	0xBD	Assist</span>
        <span class="c1">#: | 2	0xBE	Special</span>
        <span class="c1">#: | 3	0xBF	Passive A</span>
        <span class="c1">#: | 4	0xB8	Passive B</span>
        <span class="c1">#: | 5	0xB9	Passive C</span>
        <span class="c1">#: | 6	0xBA	Sacred Seal</span>
        <span class="c1">#: | 7	0xBB	Refined weapon skill effect</span>
        <span class="c1">#: | 8	0xB4	Beast transformation effect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: The element type for tome weapon skills.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tome_class</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: True if the skill cannot be inherited.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: True if the skill can only be equipped by enemies.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enemy_only</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Range of the skill for weapons and Assists, 0 for other skills.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">range</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Might for weapon skills, including bonuses that come from refinements, 0 for other skills.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">might</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Cooldown count of the skill. The total cooldown count of a unit is the sum of cooldown_count</span>
        <span class="c1">#: for all equipped skills. Skills that accelerate Special trigger have a negative value.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooldown_count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: True if the skill grants Special cooldown count-1 to the unit after this Assist is used.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assist_cd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: True if the skill is a healing Assist skill.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">healing</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#:  Range of the skill effect that comes with the given skill, e.g. 1 for Hone skills and</span>
        <span class="c1">#:  weapons that give equivalent skill effects.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skill_range</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: A value that roughly corresponds to the SP cost of the skill. Might have been used for Arena matches.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: 2 for a few low-tier Specials and staff weapons / Assists, 0 for highest-tier skills,</span>
        <span class="c1">#: and 1 for everything else. Used by derived maps to determine how far skills are allowed to promote.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">promotion_tier</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: If non-zero, this skill would be promoted on derived maps if the unit&#39;s rarity is greater than or</span>
        <span class="c1">#: equal to this value.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">promotion_rarity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: True if the skill is a refined weapon.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refined</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Internal sort value for refined weapons: 1 and 2 for skills, 101 – 104 for Atk/Spd/Def/Res refinements,</span>
        <span class="c1">#: 0 otherwise.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refine_sort_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: A bitmask indexed by weapon_index, representing weapon class effectivenesses this skill grants.</span>
        <span class="c1">#: Only meaningful on weapon skills.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wep_effective</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: A bitmask indexed by move_index, representing movement class effectivenesses this skill grants.</span>
        <span class="c1">#: Only meaningful on weapon skills.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mov_effective</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: A bitmask indexed by weapon_index, representing weapon class effectivenesses this skill protects from.</span>
        <span class="c1">#: Used by Breath of Blight.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wep_shield</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: A bitmask indexed by move_index, representing movement class effectivenesses this skill protects from.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mov_shield</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: A bitmask indexed by weapon_index, representing weapon class weaknesses this skill grants.</span>
        <span class="c1">#: Used by Loptous.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wep_weakness</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: A bitmask indexed by move_index, representing movement class weaknesses this skill grants.</span>
        <span class="c1">#: Currently unused.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mov_weakness</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: A bitmask indexed by weapon_index, representing weapon classes that receive damage from this</span>
        <span class="c1">#: skill calculated using the lower of Def or Res. Used by breaths. Only meaningful on weapon skills.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wep_adaptive</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: A bitmask indexed by move_index, representing movement classes that receive damage from this</span>
        <span class="c1">#: skill calculated using the lower of Def or Res. Currently unused. Only meaningful on weapon skills.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mov_adaptive</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: An index into the string table in Common/SRPG/SkillTiming.bin indicating the moment where the skill triggers.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timing_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: An index into the string table in Common/SRPG/SkillAbility.bin indicating the skill effect type.</span>
        <span class="c1">#: A skill can only contain one skill effect (refined weapons have an extra skill effect if</span>
        <span class="c1">#: refine_id is non-null).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ability_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: An index into the string table in Common/SRPG/SkillTiming.bin indicating the skill&#39;s activation restriction.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit1_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Restriction-dependent parameters.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit1_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: An additional activation restriction on the given skill. Both must be satisfied for the skill to activate.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit2_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit2_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: A bitmask indexed by weapon_index, representing the target&#39;s weapon classes required for the</span>
        <span class="c1">#: skill&#39;s effect to activate. If zero, works on all weapon classes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_wep</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: A bitmask indexed by move_index, representing the target&#39;s movement classes required for the</span>
        <span class="c1">#: skill&#39;s effect to activate. If zero, works on all movement classes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_mov</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Like next_skill, except that this field is null for weapons, Spur Atk 2 does not point to Spur Atk 3,</span>
        <span class="c1">#: and similarly for the three other Spur passives.</span>
        <span class="c1">#: (Death Blow 3 pointed to Death Blow 4 even before the CYL2 update.)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">passive_next</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: A POSIX timestamp relative to the skill&#39;s release date; half a month into the future for skills</span>
        <span class="c1">#: released before Version 2.0.0, 1 month into the future for skills released since Version 2.0.0.</span>
        <span class="c1">#: This skill may be equipped by random units if timestamp is -1 or the current time is past timestamp.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Indicates whether random units can equip this skill. This affects Training Tower and Allegiance Battles.</span>
        <span class="c1">#: It has 3 possible values:</span>
        <span class="c1">#: - 0: This skill may not be equipped on random units.</span>
        <span class="c1">#: - 10: This skill may be equipped on random units.</span>
        <span class="c1">#: - 20: Purpose unknown. Same effect as 10. Used by basic non-staff weapons</span>
        <span class="c1">#:   (e.g. Iron Sword, Flametongue+, Adult (Cavalry)) and basic staff Assists.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_allowed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: If non-zero, represent the lowest and highest levels respectively that allow random units</span>
        <span class="c1">#: to equip the given skill.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_lv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_lv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: If true, this skill may be considered by the 10th Stratum of the Training Tower for the</span>
        <span class="c1">#: random skill pool if it is equipped by the corresponding unit from the base map.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tt_inherit_base</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Controls how random units may equip this skill. It has 3 possible values: (see #Random skills for details)</span>
        <span class="c1">#:   - 0: This skill may not be equipped on random units.</span>
        <span class="c1">#:   - 1: This skill may be equipped by any random unit.</span>
        <span class="c1">#:   - 2: This skill may be equipped by random units that own the skill.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_mode</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: Defines the shape used for range functions (finding units within range of skill).</span>
        <span class="c1">#: Shape refers to the physical shape, such as column, row, cardinals, etc.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">range_shape</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: Controls whether skill targets units with both the targeted weapon *and* targeted</span>
        <span class="c1">#: movement type or whether having either one marks the unit as a valid target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_either</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Unknown usage</span>
        <span class="c1"># self.id_tag2 = id_tag2</span>
        <span class="c1"># self.next_seal = next_seal</span>
        <span class="c1"># self.prev_seal = prev_seal</span>
        <span class="c1"># self.ss_coin = ss_coin</span>
        <span class="c1"># self.ss_badge_type = ss_badge_type</span>
        <span class="c1"># self.ss_badge = ss_badge</span>
        <span class="c1"># self.ss_great_badge = ss_great_badge</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="Skill.activate"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Skill.activate">[docs]</a>    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># gets first limit function</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit1_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">limit1</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;stid</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;slid</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">limit1_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if the limit id is 0, there is no limit</span>
            <span class="n">limit1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="kc">True</span>

        <span class="c1"># gets second limit function</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit2_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">limit2</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;stid</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;slid</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">limit2_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if the limit id is 0, there is no limit</span>
            <span class="n">limit2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="kc">True</span>

        <span class="c1"># print(self.limit1_id, self.limit2_id)</span>

        <span class="c1"># gets the ability function</span>
        <span class="n">ability</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;stid</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;said</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ability_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">char</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;unit&quot;</span><span class="p">]</span>

        <span class="c1"># tests whether the ability activates for each character</span>
        <span class="c1"># if so, activates ability with that character as the target</span>
        <span class="c1"># for char in char_list:</span>
        <span class="c1"># print(f&quot;    {char}: {(limit1(skill=self, target=char), limit2(skill=self, target=char))}&quot;)</span>
        <span class="k">if</span> <span class="n">limit1</span><span class="p">(</span><span class="n">skill</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">char</span><span class="p">)</span> <span class="ow">and</span> <span class="n">limit2</span><span class="p">(</span><span class="n">skill</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">char</span><span class="p">):</span>
            <span class="c1"># print(f&quot;Calling for {char}&quot;)</span>
            <span class="n">call_with</span><span class="p">(</span><span class="n">ability</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">char</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">char</span><span class="p">))</span></div>

<div class="viewcode-block" id="Skill.targeted"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Skill.targeted">[docs]</a>    <span class="k">def</span> <span class="nf">targeted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="s1">&#39;Character&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return list of units within the given group which are targeted by the skill. Skill targeting</span>
<span class="sd">        is defined by the skill&#39;s target_mov and target_wep attributes.</span>

<span class="sd">        :param items:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill_targets</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span></div>

<div class="viewcode-block" id="Skill.skill_targets"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Skill.skill_targets">[docs]</a>    <span class="k">def</span> <span class="nf">skill_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Similar to :meth:`targeted` method. Return boolean value based on whether given unit is</span>
<span class="sd">        targeted by skill. Skill targeting is defined by the skill&#39;s target_mov and</span>
<span class="sd">        target_wep attributes.</span>

<span class="sd">        :param unit: :class:`Character`</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&quot;Unit move type:&quot;, unit.move_type, &quot;\nTarget move type:&quot;, self.target_mov,</span>
        <span class="c1">#       &quot;\nUnit weapon type:&quot;, unit.weapon_type, &quot;\nTarget weapon type:&quot;, self.target_wep)</span>

        <span class="n">targets_mov</span> <span class="o">=</span> <span class="n">in_bitmask</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">move_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_mov</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_mov</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">targets_wep</span> <span class="o">=</span> <span class="n">in_bitmask</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">weapon_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_wep</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_wep</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="c1"># print(f&quot;        targets_mov: {targets_mov}; targets_wep: {targets_wep}&quot;)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_either</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">targets_mov</span> <span class="ow">or</span> <span class="n">targets_wep</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">targets_mov</span> <span class="ow">and</span> <span class="n">targets_wep</span> <span class="k">else</span> <span class="kc">False</span></div>

        <span class="c1"># if self.target_either:</span>
        <span class="c1">#     return True if unit.move_type == self.target_mov or \</span>
        <span class="c1">#                    unit.weapon_type == self.target_wep else False</span>
        <span class="c1"># else:</span>
        <span class="c1">#     return True if unit.move_type == self.target_mov and \</span>
        <span class="c1">#                    unit.weapon_type == self.target_wep else False</span>

<div class="viewcode-block" id="Skill.combat_boost"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Skill.combat_boost">[docs]</a>    <span class="k">def</span> <span class="nf">combat_boost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For each stat, grants/inflicts skill&#39;s ``stat`` + skill&#39;s ``skill_params``</span>
<span class="sd">        to/on ``unit`` during combat.</span>

<span class="sd">        :param unit: :class:`Character`</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">stat</span><span class="p">,</span> <span class="n">stat_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">:</span>
            <span class="n">unit</span><span class="o">.</span><span class="n">combat_boosts</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">+=</span> <span class="n">stat_value</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill_params</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span></div>

<div class="viewcode-block" id="Skill.combat_boost2"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Skill.combat_boost2">[docs]</a>    <span class="k">def</span> <span class="nf">combat_boost2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For each stat, grants/inflicts skill&#39;s ``stat`` + skill&#39;s ``skill_params2``</span>
<span class="sd">        to/on ``unit`` during combat.</span>

<span class="sd">        :param unit: :class:`Character`</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">stat</span><span class="p">,</span> <span class="n">stat_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">:</span>
            <span class="n">unit</span><span class="o">.</span><span class="n">combat_boosts</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">+=</span> <span class="n">stat_value</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill_params</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="WeaponClass"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.WeaponClass">[docs]</a><span class="k">class</span> <span class="nc">WeaponClass</span><span class="p">(</span><span class="n">ArbitraryAttributeClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class refers to a weapon&#39;s base weapon-class. For example, the base weapon</span>
<span class="sd">    class of Clarisse&#39;s Sniper&#39;s Bow is colorless bow</span>

<span class="sd">    .. warning::</span>
<span class="sd">       Not to be confused with the :class:`Weapon` class</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#: Internal identifier tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_tag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sprite_base</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: Base weapon of this class (ex. Iron Sword for Sword weapon class)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_weapon</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: int: Weapon class range (melee or ranged)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">range</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unknown1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equip_group</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: bool: Does weapon class use res to calculate damage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_damage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: bool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_staff</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: bool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_dagger</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: bool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_breath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: bool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_beast</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Weapon"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Weapon">[docs]</a><span class="k">class</span> <span class="nc">Weapon</span><span class="p">(</span><span class="n">Skill</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1">#: :class:`WeaponClass`: Base weapon class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weapon_class</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># self.set_attribute_values()</span>

<div class="viewcode-block" id="Weapon.set_attribute_values"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Weapon.set_attribute_values">[docs]</a>    <span class="k">def</span> <span class="nf">set_attribute_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls :meth:`get_base_weapon_class` if weapon does not already have a :class:`WeaponClass`</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">weapon_class</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weapon_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_base_weapon_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Weapon.get_base_weapon_class"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Weapon.get_base_weapon_class">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_base_weapon_class</span><span class="p">(</span><span class="n">weapon</span><span class="p">):</span>
        <span class="n">weapon_data_by_base_weapon_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;base_weapon&quot;</span><span class="p">]:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">weapons_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span>

        <span class="c1"># FIXME: This can probably be combined and made more compact</span>
        <span class="n">prereqs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">pr</span><span class="p">:</span> <span class="n">pr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">weapon</span><span class="o">.</span><span class="n">prerequisites</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prereqs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weapon</span><span class="o">.</span><span class="n">id_tag</span> <span class="ow">in</span> <span class="n">weapon_data_by_base_weapon_id</span><span class="p">:</span>
                <span class="c1"># do stuff in weapon.json</span>
                <span class="n">base_weapon_class</span> <span class="o">=</span> <span class="n">weapon_data_by_base_weapon_id</span><span class="p">[</span><span class="n">weapon</span><span class="o">.</span><span class="n">id_tag</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bin_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="n">weapon</span><span class="o">.</span><span class="n">mov_equip</span><span class="p">)[</span><span class="mi">2</span><span class="p">:])))</span>
                <span class="n">base_weapon_class</span> <span class="o">=</span> <span class="n">weapon_data_by_index</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">bin_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">prereq</span> <span class="o">=</span> <span class="n">prereqs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">prereqs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">pr</span><span class="p">:</span> <span class="n">pr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">skills_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">prereq</span><span class="p">][</span><span class="s2">&quot;prerequisites&quot;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prereqs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">base_weapon_class</span> <span class="o">=</span> <span class="n">weapon_data_by_base_weapon_id</span><span class="p">[</span><span class="n">prereq</span><span class="p">]</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">prereq</span> <span class="o">=</span> <span class="n">prereqs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">WeaponClass</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">base_weapon_class</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Character"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character">[docs]</a><span class="k">class</span> <span class="nc">Character</span><span class="p">(</span><span class="n">ArbitraryAttributeClass</span><span class="p">):</span>

    <span class="c1"># __slots__ = [&#39;id_tag&#39;, &#39;roman&#39;, &#39;face_name&#39;, &#39;face_name2&#39;, &#39;legendary&#39;, &#39;dragonflowers&#39;,</span>
    <span class="c1">#              &#39;timestamp&#39;, &#39;id_num&#39;, &#39;sort_value&#39;, &#39;origins&#39;, &#39;weapon_type&#39;, &#39;tome_class&#39;,</span>
    <span class="c1">#              &#39;move_type&#39;, &#39;series&#39;, &#39;regular_hero&#39;, &#39;permanent_hero&#39;, &#39;base_vector_id&#39;,</span>
    <span class="c1">#              &#39;refresher&#39;, &#39;base_stats&#39;, &#39;growth_rates&#39;, &#39;skills&#39;, &#39;pos&#39;, &#39;node&#39;, &#39;move_range&#39;,</span>
    <span class="c1">#              &#39;rarity&#39;, &#39;level&#39;, &#39;affinity&#39;, &#39;weapon&#39;, &#39;weapon_class&#39;, &#39;color&#39;, &#39;name&#39;,</span>
    <span class="c1">#              &#39;equipped_skills&#39;, &#39;stats&#39;, &#39;buffs&#39;, &#39;debuffs&#39;, &#39;combat_boosts&#39;, &#39;counter&#39;,</span>
    <span class="c1">#              &#39;no_counter&#39;, &#39;follow_up&#39;, &#39;vantage&#39;, &#39;desperation&#39;, &#39;brave&#39;, &#39;raven&#39;, &#39;adaptive&#39;,</span>
    <span class="c1">#              &#39;adaptive_aoe&#39;, &#39;wrathful_staff&#39;, &#39;status_effects&#39;, &#39;is_initiating&#39;, &#39;special_cd&#39;,</span>
    <span class="c1">#              &#39;max_special_cd&#39;, &#39;has_acted&#39;, &#39;_id_tag&#39;, &#39;_roman&#39;, &#39;_face_name&#39;, &#39;_face_name2&#39;,</span>
    <span class="c1">#              &#39;_legendary&#39;, &#39;_dragonflowers&#39;, &#39;_timestamp&#39;, &#39;_id_num&#39;, &#39;_sort_value&#39;, &#39;_origins&#39;,</span>
    <span class="c1">#              &#39;_weapon_type&#39;, &#39;_tome_class&#39;, &#39;_move_type&#39;, &#39;_series&#39;, &#39;_regular_hero&#39;,</span>
    <span class="c1">#              &#39;_permanent_hero&#39;, &#39;_base_vector_id&#39;, &#39;_refresher&#39;, &#39;_base_stats&#39;, &#39;_growth_rates&#39;,</span>
    <span class="c1">#              &#39;_skills&#39;, &#39;_pos&#39;, &#39;_node&#39;, &#39;_move_range&#39;, &#39;_rarity&#39;, &#39;_level&#39;, &#39;_affinity&#39;,</span>
    <span class="c1">#              &#39;_weapon&#39;, &#39;_weapon_class&#39;, &#39;_color&#39;, &#39;_name&#39;, &#39;_equipped_skills&#39;, &#39;_stats&#39;,</span>
    <span class="c1">#              &#39;_buffs&#39;, &#39;_debuffs&#39;, &#39;_combat_boosts&#39;, &#39;_counter&#39;, &#39;_no_counter&#39;, &#39;_follow_up&#39;,</span>
    <span class="c1">#              &#39;_vantage&#39;, &#39;_desperation&#39;, &#39;_brave&#39;, &#39;_raven&#39;, &#39;_adaptive&#39;, &#39;_adaptive_aoe&#39;,</span>
    <span class="c1">#              &#39;_wrathful_staff&#39;, &#39;_status_effects&#39;, &#39;_is_initiating&#39;, &#39;_special_cd&#39;,</span>
    <span class="c1">#              &#39;_max_special_cd&#39;, &#39;_has_acted&#39;, &#39;_hp&#39;, ]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1">#: internal identifier tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_tag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_tag</span><span class="p">:</span> <span class="nb">str</span>
        <span class="c1">#: romanized name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roman</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roman</span><span class="p">:</span> <span class="nb">str</span>
        <span class="c1">#: stores reference to face file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_name2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_name</span><span class="p">:</span> <span class="nb">str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_name2</span><span class="p">:</span> <span class="nb">str</span>
        <span class="c1">#: character legendary status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legendary</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legendary</span><span class="p">:</span> <span class="n">Dict</span>
        <span class="c1">#: number of dragon flowers added</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dragonflowers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dragonflowers</span><span class="p">:</span> <span class="n">Dict</span>
        <span class="c1">#: release date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span>
        <span class="c1"># internal identifier number (higher the more recent a unit is)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_num</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_num</span><span class="p">:</span> <span class="nb">int</span>
        <span class="c1">#: sort priority (bitmask?)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_value</span><span class="p">:</span> <span class="nb">int</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origins</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: weapon type; integer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weapon_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weapon_type</span><span class="p">:</span> <span class="nb">int</span>
        <span class="c1">#: tome&#39;s magic type; 0 for non-magic characters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tome_class</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tome_class</span><span class="p">:</span> <span class="nb">int</span>
        <span class="c1">#: movement type (flier, infantry, armor, cavalry)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_type</span><span class="p">:</span> <span class="nb">int</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">series</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regular_hero</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regular_hero</span><span class="p">:</span> <span class="nb">bool</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">permanent_hero</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">permanent_hero</span><span class="p">:</span> <span class="nb">bool</span>
        <span class="c1">#: value used to construct stat growth vectors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_vector_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_vector_id</span><span class="p">:</span> <span class="nb">int</span>
        <span class="c1">#: dancer/singer status; boolean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresher</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresher</span><span class="p">:</span> <span class="nb">bool</span>
        <span class="c1">#: base stat values at 3 star rarity, level 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_stats</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_stats</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
        <span class="c1">#: percent growth rates for each stat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">growth_rates</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">growth_rates</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
        <span class="c1">#: List of lists: index of first list corresponds to unit rarity; index of second list</span>
        <span class="c1">#: corresponds to skill category.</span>
        <span class="c1">#: For given rarity, first 6 values (0-5) are default (already learned), remaining 8 (6-13)</span>
        <span class="c1">#: are unlockable</span>
        <span class="c1">#: - index 0 and index 6 are weapons</span>
        <span class="c1">#: - index 1 and index 7 are assists</span>
        <span class="c1">#: - index 2 and index 8 are specials</span>
        <span class="c1">#: - index 3 and index 9 are A slot (except for Drag Back on Gwendolyn)</span>
        <span class="c1">#: - index 4 and index 10 are B slot (Except Defiant Attack on Ogma)</span>
        <span class="c1">#: - index 5 and index 11 are C slot (Except HP+ on Abel)</span>
        <span class="c1">#: - index 12 is empty</span>
        <span class="c1">#: - index 13 is empty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skills</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skills</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span>

        <span class="c1">#: position; tuple (x, y)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
        <span class="c1">#: node at character&#39;s position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">:</span> <span class="n">Node</span>
        <span class="c1">#: movement range; integer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_range</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_range</span><span class="p">:</span> <span class="nb">int</span>
        <span class="c1">#: current rarity; integer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rarity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rarity</span><span class="p">:</span> <span class="nb">int</span>
        <span class="c1">#: current level; integer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span> <span class="nb">int</span>
        <span class="c1">#: affinity bonus (bonus granted by skills like gem weapons or triangle adept)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">affinity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: currently equipped weapon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Weapon</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: base weapon class (kinda useless right now?)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weapon_class</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#: unit color; integer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">:</span> <span class="nb">int</span>
        <span class="c1">#: translated unit name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
        <span class="c1">#: Currently equipped skills. Dict keys correspond to skill category.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equipped_skills</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equipped_skills</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Skill</span><span class="p">]</span>
        <span class="c1">#: stats scaled to current level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
        <span class="c1">#: visible buffs applied to unit; integer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
        <span class="c1">#: visible debuffs applied to unit; integer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debuffs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debuffs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
        <span class="c1">#: sum of invisible in-combat buffs/debuffs applied to unit; integer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combat_boosts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combat_boosts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
        <span class="c1">#: current hp value; integer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hp</span><span class="p">:</span> <span class="nb">int</span>
        <span class="c1">#: unit can counterattack regardless of opponent’s range; boolean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="p">:</span> <span class="nb">bool</span>
        <span class="c1">#: unit cannot counterattack; boolean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_counter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_counter</span><span class="p">:</span> <span class="nb">bool</span>
        <span class="c1">#: can unit make a follow-up (1 = guaranteed, 0 = normal, -1 = no follow-up); integer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">follow_up</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">follow_up</span><span class="p">:</span> <span class="nb">int</span>
        <span class="c1">#: does unit have vantage; boolean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vantage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vantage</span><span class="p">:</span> <span class="nb">bool</span>
        <span class="c1">#: does unit have desperation; boolean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desperation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desperation</span><span class="p">:</span> <span class="nb">bool</span>
        <span class="c1">#: does unit have brave effect; boolean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brave</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brave</span><span class="p">:</span> <span class="nb">bool</span>
        <span class="c1">#: does unit have raven effect; boolean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raven</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raven</span><span class="p">:</span> <span class="nb">bool</span>
        <span class="c1">#: does unit have adaptive damage; boolean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adaptive</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adaptive</span><span class="p">:</span> <span class="nb">bool</span>
        <span class="c1">#: does unit have adaptive special damage; boolean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adaptive_aoe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adaptive_aoe</span><span class="p">:</span> <span class="nb">bool</span>
        <span class="c1">#: does unit calculate damage from staff like normal weapons; boolean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrathful_staff</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrathful_staff</span><span class="p">:</span> <span class="nb">bool</span>
        <span class="c1">#: dictionary of status effects on unit; string keys and boolean values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_effects</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_effects</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span>
        <span class="c1">#: is unit the one initiating combat; boolean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_initiating</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_initiating</span><span class="p">:</span> <span class="nb">bool</span>
        <span class="c1"># TODO: Make equipping a special skill affect this value</span>
        <span class="c1">#: Current special cooldown value; int</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">special_cd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">special_cd</span><span class="p">:</span> <span class="nb">int</span>
        <span class="c1">#: Maximum special cooldown value; int</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_special_cd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_special_cd</span><span class="p">:</span> <span class="nb">int</span>
        <span class="c1">#: has unit acted already; boolean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_acted</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_acted</span><span class="p">:</span> <span class="nb">bool</span>
        <span class="c1">#: Unit&#39;s asset stat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">asset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">asset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
        <span class="c1">#: Unit&#39;s flaw stat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flaw</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flaw</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># scope = self.__dict__.copy()</span>
        <span class="c1">#</span>
        <span class="c1"># # print(&quot;Self scope:&quot;, scope)</span>
        <span class="c1"># self_properties(self, scope)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_attribute_values</span><span class="p">()</span>

        <span class="c1"># print(&quot;Self dir:&quot;, dir(self))</span>
        <span class="c1"># print(&quot;Self __dict__:&quot;, self.__dict__)</span>
        <span class="c1"># print(&quot;Self __slots__:&quot;, self.__slots__)</span>

        <span class="n">char_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># def __setattr__(self, key, value):</span>
    <span class="c1">#</span>
    <span class="c1">#     if Switch.validate_character_attribute(key, value):</span>
    <span class="c1">#         super().__setattr__(key, value)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         raise ValueError(&quot;Invalid value supplied for {0} attribute of {1}&quot;.format(key, self))</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="s2"> (</span><span class="si">{2}</span><span class="s2"> object with id </span><span class="si">{3}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id_tag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">roman</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">with</span> <span class="n">properties</span><span class="p">(</span><span class="nb">locals</span><span class="p">(),</span> <span class="s1">&#39;meta&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">meta</span><span class="p">:</span>
        <span class="nd">@meta</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="n">listener</span><span class="o">=</span><span class="s1">&#39;hp_change&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">hp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;hp&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hp</span>

<div class="viewcode-block" id="Character.hp_change"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.hp_change">[docs]</a>    <span class="k">def</span> <span class="nf">hp_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Listener function for changes in a :class:`Character`&#39;s hp. Checks whether hp change resulted</span>
<span class="sd">        in death.</span>

<span class="sd">        :param prop:</span>
<span class="sd">        :param old:</span>
<span class="sd">        :param new:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_is_dead</span><span class="p">()</span></div>

<div class="viewcode-block" id="Character.set_attribute_values"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.set_attribute_values">[docs]</a>    <span class="k">def</span> <span class="nf">set_attribute_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets default values for character attributes</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># if character&#39;s position is defined, sets &quot;node&quot; attribute to a Node object in the map grid and</span>
        <span class="c1"># sets node&#39;s &quot;holds&quot; attribute to character</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">GRID</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">GRID</span><span class="o">.</span><span class="n">get_index_from_xy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">holds</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c1"># for all attributes below, checks whether attribute is already set, and if not, sets to</span>
        <span class="c1"># default value; sets movement range based on movement type</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_range</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">move_range</span> <span class="o">=</span> <span class="n">move_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">move_type</span><span class="p">][</span><span class="s2">&quot;range&quot;</span><span class="p">]</span>
        <span class="c1"># sets rarity to 3 stars by default</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rarity</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rarity</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="c1"># sets character level to 1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># sets affinity bonus to 0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">affinity</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">affinity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># sets stats to base stats for current level</span>
        <span class="c1"># TODO: Add support for IVs</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="c1"># self.stats = self.base_stats</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_stats_to_stats_for_level</span><span class="p">()</span>
        <span class="c1"># sets current buffs to 0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buffs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;atk&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;spd&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;def&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;res&quot;</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">debuffs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debuffs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;atk&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;spd&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;def&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;res&quot;</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">}</span>
        <span class="c1"># sets current in-combat buffs/debuffs sum to 0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">combat_boosts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">combat_boosts</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;atk&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;spd&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;def&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;res&quot;</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">}</span>
        <span class="c1"># sets current hp to base hp value for current level</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hp&quot;</span><span class="p">]</span>
        <span class="c1"># sets color based on weapon type</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">weapon_index_to_color_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">weapon_type</span><span class="p">]</span>
        <span class="c1"># sets weapon class based on weapon type (not needed?)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">weapon_class</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weapon_class</span> <span class="o">=</span> <span class="n">WeaponClass</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">weapon_data_by_index</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">weapon_type</span><span class="p">])</span>

        <span class="c1"># equips weapon to unit; defaults to None (recently added id_tag part, check it)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equip_weapon</span><span class="p">(</span><span class="n">weapon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="p">)</span>

        <span class="c1"># sets character&#39;s name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">translate_jp_to_en_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="n">english_data</span><span class="p">,</span>
                                                    <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;MPID&quot;</span><span class="p">,</span> <span class="n">old_prefix</span><span class="o">=</span><span class="s2">&quot;PID&quot;</span><span class="p">))</span>

        <span class="c1"># sets character&#39;s equipped skill for each category to None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">equipped_skills</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">equipped_skills</span> <span class="o">=</span> <span class="p">{</span>

                <span class="s2">&quot;assist&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;special&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;seal&quot;</span><span class="p">:</span> <span class="kc">None</span>
            <span class="p">}</span></div>

<div class="viewcode-block" id="Character.check_is_dead"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.check_is_dead">[docs]</a>    <span class="k">def</span> <span class="nf">check_is_dead</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hp</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">()</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Character.validate_skill"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.validate_skill">[docs]</a>    <span class="k">def</span> <span class="nf">validate_skill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill</span><span class="p">:</span> <span class="n">Skill</span><span class="p">):</span>
        <span class="c1"># checks if character is of correct weapon type and move type</span>
        <span class="k">if</span> <span class="n">in_bitmask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weapon_type</span><span class="p">,</span> <span class="n">skill</span><span class="o">.</span><span class="n">wep_equip</span><span class="p">)</span> <span class="ow">and</span> <span class="n">in_bitmask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">move_type</span><span class="p">,</span> <span class="n">skill</span><span class="o">.</span><span class="n">mov_equip</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">skill</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
                <span class="c1"># checks if character owns exclusive skill</span>
                <span class="n">owns_skill</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">skillset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skills</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">skill</span><span class="o">.</span><span class="n">id_tag</span> <span class="ow">in</span> <span class="n">skillset</span><span class="p">:</span>
                        <span class="n">owns_skill</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">owns_skill</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">skill</span><span class="o">.</span><span class="n">enemy_only</span><span class="p">:</span>
                <span class="c1"># checks if character is an enemy</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">==</span> <span class="n">Enemy</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_tag</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;EID_&quot;</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">skill</span><span class="o">.</span><span class="n">healing</span><span class="p">:</span>
                <span class="c1"># checks if character is a staff unit</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weapon_type</span> <span class="o">!=</span> <span class="mi">15</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Character.get_skill"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.get_skill">[docs]</a>    <span class="k">def</span> <span class="nf">get_skill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">skill</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">category_name_to_number_dict</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rarity</span><span class="p">):</span>
            <span class="n">skill</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skills</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">category</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skills</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">category</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">skill</span>
        <span class="k">if</span> <span class="n">skills_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">skill</span><span class="p">][</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">category</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Skill</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">skills_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">skill</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SkillIsIncorrectCategoryException</span><span class="p">(</span>
                <span class="s2">&quot;Skill should be a category </span><span class="si">{0}</span><span class="s2"> skill, received category </span><span class="si">{1}</span><span class="s2"> skill instead&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">skills_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">skill</span><span class="p">][</span><span class="s2">&quot;category&quot;</span><span class="p">]))</span>
            <span class="p">)</span>
        <span class="k">pass</span></div>

    <span class="c1"># handles equipping a skill to a character</span>
<div class="viewcode-block" id="Character.equip_skill"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.equip_skill">[docs]</a>    <span class="k">def</span> <span class="nf">equip_skill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">skill</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># create Skill object from weapon id</span>
            <span class="n">skill</span> <span class="o">=</span> <span class="n">Skill</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">skills_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">skill</span><span class="p">])</span>
            <span class="c1"># check whether character can equip skill</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_skill</span><span class="p">(</span><span class="n">skill</span><span class="p">):</span>

                <span class="n">category</span> <span class="o">=</span> <span class="n">category_number_to_name_dict</span><span class="p">[</span><span class="n">skill</span><span class="o">.</span><span class="n">category</span><span class="p">]</span>

                <span class="c1"># if character already has a weapon equipped, unequip it</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">equipped_skills</span><span class="p">[</span><span class="n">category</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">unequip_skill</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>

                <span class="c1"># # add weapon&#39;s might to character&#39;s attack stat</span>
                <span class="c1"># self.stats[&quot;atk&quot;] += weapon.might</span>

                <span class="c1"># add skill&#39;s stat bonuses to character&#39;s stats</span>
                <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">skill</span><span class="o">.</span><span class="n">stats</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">+=</span> <span class="n">skill</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hp</span> <span class="o">+=</span> <span class="n">skill</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hp&quot;</span><span class="p">]</span>

                <span class="c1"># update character&#39;s equipped_skills attribute with skill</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">equipped_skills</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="n">skill</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if skill fails to pass validation, character cannot equip skill</span>
                <span class="k">raise</span> <span class="n">InvalidWeapon</span><span class="p">(</span><span class="s2">&quot;Character </span><span class="si">{0}</span><span class="s2"> does not have access to skill </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill</span><span class="o">.</span><span class="n">id_tag</span><span class="p">))</span></div>

    <span class="c1"># handles unequipping a skill from a character</span>
<div class="viewcode-block" id="Character.unequip_skill"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.unequip_skill">[docs]</a>    <span class="k">def</span> <span class="nf">unequip_skill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">skill</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equipped_skills</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">skill</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">Skill</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">skill</span><span class="o">.</span><span class="n">stats</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">-=</span> <span class="n">skill</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span>
                <span class="c1"># TODO: Create getter/setter for self.stats to auto-modify self.hp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hp</span> <span class="o">-=</span> <span class="n">skill</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hp&quot;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">equipped_skills</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">pass</span></div>

    <span class="c1"># TODO: Add in support for automatic skill/weapon generation for TT and the like</span>
<div class="viewcode-block" id="Character.validate_weapon"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.validate_weapon">[docs]</a>    <span class="k">def</span> <span class="nf">validate_weapon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weapon</span><span class="p">:</span> <span class="n">Weapon</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether unit may possess weapon</span>

<span class="sd">        :type weapon: Weapon</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># checks if character is of correct weapon type and move type</span>
        <span class="k">if</span> <span class="n">in_bitmask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weapon_type</span><span class="p">,</span> <span class="n">weapon</span><span class="o">.</span><span class="n">wep_equip</span><span class="p">)</span> <span class="ow">and</span> <span class="n">in_bitmask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">move_type</span><span class="p">,</span> <span class="n">weapon</span><span class="o">.</span><span class="n">mov_equip</span><span class="p">):</span>

            <span class="c1"># FIXME: Does not currently support refined weapons</span>
            <span class="c1"># Idea for refined weapons: check num of underscores, greater than 1, remove suffix and check base</span>
            <span class="k">if</span> <span class="n">weapon</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
                <span class="c1"># checks if character owns exclusive weapon</span>
                <span class="n">owns_weapon</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">skillset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skills</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">weapon</span><span class="o">.</span><span class="n">id_tag</span> <span class="ow">in</span> <span class="n">skillset</span><span class="p">:</span>
                        <span class="n">owns_weapon</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">owns_weapon</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Does not own weapon&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">weapon</span><span class="o">.</span><span class="n">enemy_only</span><span class="p">:</span>
                <span class="c1"># checks if character is an enemy</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">==</span> <span class="n">Enemy</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_tag</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;EID_&quot;</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Character.get_weapon"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.get_weapon">[docs]</a>    <span class="k">def</span> <span class="nf">get_weapon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">weapon</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rarity</span><span class="p">):</span>
            <span class="n">weapon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skills</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skills</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">weapon</span>
        <span class="k">if</span> <span class="n">skills_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">weapon</span><span class="p">][</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Weapon</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">skills_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">weapon</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SkillIsIncorrectCategoryException</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Weapon should be a category 0 skill, received category &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">skills_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">weapon</span><span class="p">][</span><span class="s2">&quot;category&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; skill instead&quot;</span><span class="p">))</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Character.equip_weapon"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.equip_weapon">[docs]</a>    <span class="k">def</span> <span class="nf">equip_weapon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weapon</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Weapon</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles equipping a weapon to a character</span>

<span class="sd">        :param weapon:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">weapon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weapon</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># create weapon object from weapon id</span>
                <span class="n">weapon</span> <span class="o">=</span> <span class="n">Weapon</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">skills_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">weapon</span><span class="p">])</span>

            <span class="c1"># check whether character can equip weapon</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_weapon</span><span class="p">(</span><span class="n">weapon</span><span class="p">):</span>

                <span class="c1"># if character already has a weapon equipped, unequip it</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">unequip_weapon</span><span class="p">()</span>

                <span class="c1"># add weapon&#39;s might to character&#39;s attack stat</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;atk&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weapon</span><span class="o">.</span><span class="n">might</span>

                <span class="c1"># add weapon&#39;s stat bonuses to character&#39;s stats (separate from might)</span>
                <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">weapon</span><span class="o">.</span><span class="n">stats</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weapon</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hp</span> <span class="o">+=</span> <span class="n">weapon</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hp&quot;</span><span class="p">]</span>

                <span class="c1"># set character&#39;s weapon attribute to weapon</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span> <span class="o">=</span> <span class="n">weapon</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if weapon fails to pass validation, character cannot equip weapon</span>
                <span class="k">raise</span> <span class="n">InvalidWeapon</span><span class="p">(</span><span class="s2">&quot;Character </span><span class="si">{0}</span><span class="s2"> does not have access to weapon </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weapon</span><span class="o">.</span><span class="n">id_tag</span><span class="p">))</span>

        <span class="c1"># if weapon to equip is None, unequip weapon</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unequip_weapon</span><span class="p">()</span></div>

<div class="viewcode-block" id="Character.unequip_weapon"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.unequip_weapon">[docs]</a>    <span class="k">def</span> <span class="nf">unequip_weapon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles unequipping a weapon</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="p">,</span> <span class="n">Weapon</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;atk&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">might</span>

                <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">stats</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hp</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hp&quot;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Character.get_distance_to"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.get_distance_to">[docs]</a>    <span class="k">def</span> <span class="nf">get_distance_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enemy</span><span class="p">:</span> <span class="s2">&quot;Character&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns distance from unit to `enemy`</span>

<span class="sd">        :param enemy:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enemy</span><span class="p">)</span></div>

<div class="viewcode-block" id="Character.calc_weapon_triangle"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.calc_weapon_triangle">[docs]</a>    <span class="k">def</span> <span class="nf">calc_weapon_triangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enemy</span><span class="p">:</span> <span class="s2">&quot;Character&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether unit has weapon advantage/disadvantage against `enemy` and returns</span>
<span class="sd">        corresponding attack multiplier value as a percent (i.e., 0.2, -0.2, or 0)</span>

<span class="sd">        :param enemy:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># if character has weapon triangle advantage, increase attack by 20%</span>
        <span class="k">if</span> <span class="n">enemy</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="n">weapon_advantage</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">]:</span>
            <span class="k">return</span> <span class="mf">0.2</span>
        <span class="c1"># if character has weapon triangle disadvantage, decrease attack by 20%</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="n">weapon_advantage</span><span class="p">[</span><span class="n">enemy</span><span class="o">.</span><span class="n">color</span><span class="p">]:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mf">0.2</span>
        <span class="c1"># if character has neither weapon triangle advantage or disadvantage, do not modify attack</span>
        <span class="c1"># if either character or enemy is colorless, weapon triangle does not apply</span>
        <span class="c1"># FIXME: Add support for raven-tomes and weapon triangle advantage against colorless</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="n">enemy</span><span class="o">.</span><span class="n">color</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s2">&quot;gray&quot;</span> <span class="ow">or</span> <span class="n">enemy</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s2">&quot;gray&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Character.calc_effectiveness"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.calc_effectiveness">[docs]</a>    <span class="k">def</span> <span class="nf">calc_effectiveness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enemy</span><span class="p">:</span> <span class="s2">&quot;Character&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether unit has weapon effectiveness against `enemy` and returns</span>
<span class="sd">        corresponding attack multiplier value (i.e., 1.5 or 1)</span>

<span class="sd">        :param enemy:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># assertions used to force IDE autocompletion</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">enemy</span><span class="o">.</span><span class="n">weapon</span><span class="p">,</span> <span class="n">Weapon</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="p">,</span> <span class="n">Weapon</span><span class="p">)</span>

        <span class="c1"># bitmask of movement types unit has effectiveness against</span>
        <span class="n">mov_effective</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">mov_effective</span>
        <span class="c1"># bitmask of weapon types unit has effectiveness against</span>
        <span class="n">wep_effective</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">wep_effective</span>

        <span class="c1"># if unit is effective against enemy movement type or enemy has movement weakness,</span>
        <span class="c1"># and enemy does not have a movement shield effect, then deal 50% extra damage</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">in_bitmask</span><span class="p">(</span><span class="n">enemy</span><span class="o">.</span><span class="n">move_type</span><span class="p">,</span> <span class="n">mov_effective</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">in_bitmask</span><span class="p">(</span><span class="n">enemy</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">mov_weakness</span><span class="p">,</span> <span class="n">mov_effective</span><span class="p">))</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="n">in_bitmask</span><span class="p">(</span><span class="n">enemy</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">mov_shield</span><span class="p">,</span> <span class="n">mov_effective</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.5</span>

        <span class="c1"># if unit is effective against enemy weapon type or enemy has weapon weakness,</span>
        <span class="c1"># and enemy does not have a weapon shield effect, then deal 50% extra damage</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">in_bitmask</span><span class="p">(</span><span class="n">enemy</span><span class="o">.</span><span class="n">weapon_type</span><span class="p">,</span> <span class="n">wep_effective</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">in_bitmask</span><span class="p">(</span><span class="n">enemy</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">wep_weakness</span><span class="p">,</span> <span class="n">wep_effective</span><span class="p">))</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="n">in_bitmask</span><span class="p">(</span><span class="n">enemy</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">wep_shield</span><span class="p">,</span> <span class="n">wep_effective</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.5</span>

        <span class="c1"># otherwise, deal normal damage</span>
        <span class="k">return</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Character.calc_boosted_damage"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.calc_boosted_damage">[docs]</a>    <span class="k">def</span> <span class="nf">calc_boosted_damage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enemy</span><span class="p">:</span> <span class="s2">&quot;Character&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span></div>
        <span class="c1"># TODO: add functionality</span>

<div class="viewcode-block" id="Character.set_stats_to_stats_for_level"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.set_stats_to_stats_for_level">[docs]</a>    <span class="k">def</span> <span class="nf">set_stats_to_stats_for_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets stats for unit at current level and sets stats to corresponding values</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stat_increases</span> <span class="o">=</span> <span class="n">StatGrowth</span><span class="o">.</span><span class="n">get_all_stat_increases_for_level</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">stat_increases</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_stats</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">+</span> <span class="n">stat_increases</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span></div>

<div class="viewcode-block" id="Character.damage_enemy"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.damage_enemy">[docs]</a>    <span class="k">def</span> <span class="nf">damage_enemy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enemy</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">,</span> <span class="n">damage</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">enemy</span><span class="o">.</span><span class="n">hp</span> <span class="o">-=</span> <span class="n">damage</span></div>
        <span class="c1"># add on_damage effects here</span>

<div class="viewcode-block" id="Character.attack_enemy"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.attack_enemy">[docs]</a>    <span class="k">def</span> <span class="nf">attack_enemy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enemy</span><span class="p">:</span> <span class="s2">&quot;Character&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles attacking an `enemy`</span>

<span class="sd">        :param enemy:</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="p">,</span> <span class="n">Weapon</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">enemy</span><span class="o">.</span><span class="n">weapon</span><span class="p">,</span> <span class="n">Weapon</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">enemy</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You can&#39;t attack yourself silly&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">enemy</span><span class="o">.</span><span class="n">hp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distance_to</span><span class="p">(</span><span class="n">enemy</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">range</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Enemy in range, commencing attack&quot;</span><span class="p">)</span>

                <span class="c1"># TODO: Create function for this</span>
                <span class="n">atk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;atk&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffs</span><span class="p">[</span><span class="s2">&quot;atk&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">combat_boosts</span><span class="p">[</span><span class="s2">&quot;atk&quot;</span><span class="p">]</span>

                <span class="c1"># TODO: Add support for adaptive damage</span>
                <span class="c1"># self.weapon.tome_class</span>
                <span class="n">mit_stat</span> <span class="o">=</span> <span class="s2">&quot;def&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tome_class</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;res&quot;</span>
                <span class="n">mitigation</span> <span class="o">=</span> <span class="n">enemy</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">mit_stat</span><span class="p">]</span> <span class="o">+</span> <span class="n">enemy</span><span class="o">.</span><span class="n">buffs</span><span class="p">[</span><span class="n">mit_stat</span><span class="p">]</span> <span class="o">+</span> <span class="n">enemy</span><span class="o">.</span><span class="n">combat_boosts</span><span class="p">[</span><span class="n">mit_stat</span><span class="p">]</span>

                <span class="n">damage</span> <span class="o">=</span> <span class="n">pos</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">atk</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_effectiveness</span><span class="p">(</span><span class="n">enemy</span><span class="p">))</span> <span class="o">+</span> <span class="n">trunc</span><span class="p">(</span>
                    <span class="n">floor</span><span class="p">(</span><span class="n">atk</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_effectiveness</span><span class="p">(</span><span class="n">enemy</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_weapon_triangle</span><span class="p">(</span><span class="n">enemy</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">affinity</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_boosted_damage</span><span class="p">(</span><span class="n">enemy</span><span class="p">)</span> <span class="o">-</span> <span class="n">mitigation</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">damage_enemy</span><span class="p">(</span><span class="n">enemy</span><span class="p">,</span> <span class="n">damage</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">enemy</span><span class="o">.</span><span class="n">hp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;dealt&quot;</span><span class="p">,</span> <span class="n">damage</span><span class="p">,</span> <span class="s2">&quot;damage,&quot;</span><span class="p">,</span> <span class="n">enemy</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;has&quot;</span><span class="p">,</span> <span class="n">enemy</span><span class="o">.</span><span class="n">hp</span><span class="p">,</span> <span class="s2">&quot;HP remaining&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;dealt&quot;</span><span class="p">,</span> <span class="n">damage</span><span class="p">,</span> <span class="s2">&quot;damage,&quot;</span><span class="p">,</span> <span class="n">enemy</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;has been defeated&quot;</span><span class="p">)</span>
                    <span class="c1"># enemy.die()</span>

                <span class="k">return</span> <span class="kc">None</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Enemy not in range&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Enemy has already been defeated&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Character.attack_node"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.attack_node">[docs]</a>    <span class="k">def</span> <span class="nf">attack_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attacks a designated node using :meth:`attack_enemy`</span>

<span class="sd">        :param node:</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">enemy</span> <span class="o">=</span> <span class="n">GRID</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">GRID</span><span class="o">.</span><span class="n">get_index_from_xy</span><span class="p">(</span><span class="n">pos</span><span class="p">)]</span><span class="o">.</span><span class="n">holds</span>
        <span class="k">if</span> <span class="n">enemy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attack_enemy</span><span class="p">(</span><span class="n">enemy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is no enemy at position&quot;</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span></div>

<div class="viewcode-block" id="Character.move"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.move">[docs]</a>    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_pos</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles character movement</span>

<span class="sd">        :param new_pos:</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;moved&quot;</span><span class="p">,</span> <span class="n">get_distance_from_tuples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">new_pos</span><span class="p">),</span> <span class="s2">&quot;spaces from&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">new_pos</span><span class="p">)</span>
        <span class="n">GRID</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">GRID</span><span class="o">.</span><span class="n">get_index_from_xy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)]</span><span class="o">.</span><span class="n">holds</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">new_pos</span>
        <span class="n">GRID</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">GRID</span><span class="o">.</span><span class="n">get_index_from_xy</span><span class="p">(</span><span class="n">new_pos</span><span class="p">)]</span><span class="o">.</span><span class="n">holds</span> <span class="o">=</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Character.fight"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.fight">[docs]</a>    <span class="k">def</span> <span class="nf">fight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enemy</span><span class="p">:</span> <span class="s2">&quot;Character&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles a fight between unit and `enemy`. Uses :meth:`attack_enemy` for both sides and</span>
<span class="sd">        calculates whether either side doubles.</span>

<span class="sd">        :param enemy:</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_initiating</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># TODO: Add check for vantage skill</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attack_enemy</span><span class="p">(</span><span class="n">enemy</span><span class="p">)</span>
        <span class="c1"># is this check necessary? Already checks in attack_enemy function</span>
        <span class="k">if</span> <span class="n">enemy</span><span class="o">.</span><span class="n">hp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># TODO: Add checks for &quot;prevent counterattack&quot; status, weapon range, distant/close counter skills</span>
            <span class="c1"># TODO: Add check for desperation skill</span>
            <span class="n">enemy</span><span class="o">.</span><span class="n">attack_enemy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="c1"># FIXME: Apply buffs/debuffs</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;spd&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">enemy</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;spd&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hp&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">attack_enemy</span><span class="p">(</span><span class="n">enemy</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">enemy</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;spd&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;spd&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">enemy</span><span class="o">.</span><span class="n">attack_enemy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Do after-combat checks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_initiating</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Character.move_to_attack"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.move_to_attack">[docs]</a>    <span class="k">def</span> <span class="nf">move_to_attack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enemy</span><span class="p">:</span> <span class="s2">&quot;Character&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Intended for use by AI (or lazy players I guess). Moves unit using :meth:`move_towards` and</span>
<span class="sd">        then attacks `enemy` using :meth:`fight`</span>

<span class="sd">        :param enemy:</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoints</span> <span class="o">=</span> <span class="n">GRID</span><span class="o">.</span><span class="n">dijkstra</span><span class="p">(</span><span class="n">enemy</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">eval_to_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">range</span><span class="p">)</span>

        <span class="n">endpoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">get_distance_from_tuples</span><span class="p">(</span><span class="n">enemy</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">range</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span> <span class="ow">in</span> <span class="n">endpoints</span><span class="p">]</span> <span class="k">if</span>
                     <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

        <span class="n">endpoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">endpoint</span> <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">endpoints</span> <span class="k">if</span>
                     <span class="n">get_distance_from_tuples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_range</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">endpoints</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No available moves that can target&quot;</span><span class="p">,</span> <span class="n">enemy</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Chose position&quot;</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;from possible positions&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">endpoint</span><span class="o">.</span><span class="n">data</span> <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">endpoints</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;stays where they are and attacks&quot;</span><span class="p">,</span> <span class="n">enemy</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;at position&quot;</span><span class="p">,</span> <span class="n">enemy</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;moves to&quot;</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;to attack&quot;</span><span class="p">,</span> <span class="n">enemy</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;at position&quot;</span><span class="p">,</span> <span class="n">enemy</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">endpoint</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">fight</span><span class="p">(</span><span class="n">enemy</span><span class="p">)</span></div>

<div class="viewcode-block" id="Character.move_towards"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.move_towards">[docs]</a>    <span class="k">def</span> <span class="nf">move_towards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enemy</span><span class="p">:</span> <span class="s2">&quot;Character&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utilizes dijkstra algorithm to find valid spaces from which unit can attack `enemy`</span>
<span class="sd">        and moves unit to closest.</span>

<span class="sd">        :param enemy:</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">weight</span><span class="p">,</span> <span class="n">nodes</span> <span class="o">=</span> <span class="n">GRID</span><span class="o">.</span><span class="n">dijkstra</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">enemy</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">only_end</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">distance</span> <span class="o">=</span> <span class="n">get_distance_from_tuples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">enemy</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">distance</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">range</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;is already in range and does not move&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">distance</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">range</span><span class="p">:</span>
            <span class="n">move_distance</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">range</span>
            <span class="k">if</span> <span class="n">move_distance</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_range</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">move_range</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">move_distance</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">range</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;is too close and moves further away&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Character.move_direction"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.move_direction">[docs]</a>    <span class="k">def</span> <span class="nf">move_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Moves unit in the specified direction.</span>

<span class="sd">        :param direction: X,Y tuple specifying the individual distances to move in the</span>
<span class="sd">        X and Y directions</span>
<span class="sd">        :param distance: Integer value by which direction tuple is scaled. Defaults to one.</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">tuple_add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">scale_tuple</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="n">distance</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Character.die"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.die">[docs]</a>    <span class="k">def</span> <span class="nf">die</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles unit death. Removes unit from the field and :data:`char_list`.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">:</span>
            <span class="n">GRID</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">GRID</span><span class="o">.</span><span class="n">get_index_from_xy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)]</span><span class="o">.</span><span class="n">holds</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">char_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Character.stat"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.stat">[docs]</a>    <span class="k">def</span> <span class="nf">stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat_num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes in number between 0 and 4 and translates to corresponding stat, then returns</span>
<span class="sd">        unit&#39;s value for this stat.</span>

<span class="sd">        :param stat_num: Integer between 0 and 4</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">stat_num_to_name_dict</span><span class="p">[</span><span class="n">stat_num</span><span class="p">]]</span></div>

<div class="viewcode-block" id="Character.stat2"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.stat2">[docs]</a>    <span class="k">def</span> <span class="nf">stat2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat_num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes in number between 0 and 4 and translates to corresponding stat, then returns sum of</span>
<span class="sd">        unit&#39;s value for this stat and this stat&#39;s current buff.</span>

<span class="sd">        :param stat_num: Integer between 0 and 4</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stat_name</span> <span class="o">=</span> <span class="n">stat_num_to_name_dict</span><span class="p">[</span><span class="n">stat_num</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">stat_name</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffs</span><span class="p">[</span><span class="n">stat_name</span><span class="p">]</span></div>

<div class="viewcode-block" id="Character.stat_difference"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Character.stat_difference">[docs]</a>    <span class="k">def</span> <span class="nf">stat_difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat_num</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Character&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns difference between given stat for unit and `other` unit.</span>

<span class="sd">        :param stat_num: Integer between 0 and 4</span>
<span class="sd">        :param other:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Include phantom skills in calculation</span>
        <span class="c1"># CHECK: Should I wrap this in abs()?</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">stat_num</span><span class="p">)</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">stat_num</span><span class="p">)</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="Enemy"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Enemy">[docs]</a><span class="k">class</span> <span class="nc">Enemy</span><span class="p">(</span><span class="n">Character</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enemy class. Defines behaviors and characteristics for enemy units.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Player"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Player">[docs]</a><span class="k">class</span> <span class="nc">Player</span><span class="p">(</span><span class="n">Character</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Player class. Defines behaviors and characteristics for player units.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># CLASS DEFINITIONS END</span>
<span class="c1"># ============================================================================================================</span>

<span class="c1"># ============================================================================================================</span>
<span class="c1"># GENERAL DEFINITIONS START</span>

<div class="viewcode-block" id="tuple_add"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.tuple_add">[docs]</a><span class="k">def</span> <span class="nf">tuple_add</span><span class="p">(</span><span class="n">tup1</span><span class="p">,</span> <span class="n">tup2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple utility function that adds 2 (X,Y) tuples and returns the result.</span>

<span class="sd">    :param tup1:</span>
<span class="sd">    :param tup2:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">tup1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">tup2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tup1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">tup2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="scale_tuple"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.scale_tuple">[docs]</a><span class="k">def</span> <span class="nf">scale_tuple</span><span class="p">(</span><span class="n">tup</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple utility function that scales an (X,Y) tuple by an integer value and returns the result.</span>

<span class="sd">    :param tup:</span>
<span class="sd">    :param scale:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_distance_from_tuples"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.get_distance_from_tuples">[docs]</a><span class="k">def</span> <span class="nf">get_distance_from_tuples</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">enemy</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple utility function that returns the distance between 2 (X,Y) tuples. Distance is not the</span>
<span class="sd">    minimal diagonal distance as given by the standard distance function, but rather the tile-based</span>
<span class="sd">    distance used to navigate grids. For example, if an object A is at position (1,1) and an object B</span>
<span class="sd">    is at position (3,4), the distance is 5 (as opposed to the shortest-route diagonal distance of</span>
<span class="sd">    3.60555...)</span>

<span class="sd">    :param self:</span>
<span class="sd">    :param enemy:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">enemy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">enemy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="get_distance"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.get_distance">[docs]</a><span class="k">def</span> <span class="nf">get_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Character</span><span class="p">,</span> <span class="n">enemy</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple utility function that returns the distance between 2 (X,Y) :class:`Character` units.</span>
<span class="sd">    Uses the same logic as in :func:`get_distance_from_tuples`.</span>

<span class="sd">    :param self:</span>
<span class="sd">    :param enemy:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">enemy</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">enemy</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="convert_to_bitmask_list"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.convert_to_bitmask_list">[docs]</a><span class="k">def</span> <span class="nf">convert_to_bitmask_list</span><span class="p">(</span><span class="n">int_bitmask</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts integer bitmask to list of 1&#39;s and 0&#39;s, e.g if &#39;int_bitmask&#39; is 571,</span>
<span class="sd">    returns [1, 1, 0, 1, 1, 1, 0, 0, 0, 1]</span>

<span class="sd">    :param int_bitmask:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="n">int_bitmask</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">])))</span></div>


<div class="viewcode-block" id="filter_true_indexes"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.filter_true_indexes">[docs]</a><span class="k">def</span> <span class="nf">filter_true_indexes</span><span class="p">(</span><span class="n">bitmask_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a bitmask list &#39;bitmask_list&#39; (output from convert_to_bitmask_list function) and returns a list</span>
<span class="sd">    of integers for each index in &#39;bitmask_list&#39; at which the value is True (or in this case, 1)</span>

<span class="sd">    :param bitmask_list:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bitmask_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="p">]</span></div>


<div class="viewcode-block" id="in_bitmask"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.in_bitmask">[docs]</a><span class="k">def</span> <span class="nf">in_bitmask</span><span class="p">(</span><span class="n">nums</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">bitmask</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an integer bitmask &#39;bitmask&#39;, converts to binary, and casts binary to a list of ones and</span>
<span class="sd">    zeroes, &#39;bitmask_list&#39;.</span>

<span class="sd">    If &#39;nums&#39; is an integer:</span>
<span class="sd">         Indexes &#39;bitmask_list&#39; by &#39;nums&#39;, if value at index is 1 returns True, else False</span>

<span class="sd">    If &#39;nums&#39; is an Iterable of integers:</span>
<span class="sd">        For &#39;num&#39; in &#39;nums&#39;, indexes &#39;bitmask_list&#39; by &#39;num&#39;, if value at index is 1 sets value to True</span>
<span class="sd">        at key &#39;num&#39; in &#39;in_bitmask_dict&#39; else sets value to False</span>

<span class="sd">    :param nums:</span>
<span class="sd">    :param bitmask:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">bitmask_list</span> <span class="o">=</span> <span class="n">convert_to_bitmask_list</span><span class="p">(</span><span class="n">bitmask</span><span class="p">)</span>

    <span class="n">in_bitmask_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="c1"># print(&quot;Bitmask:&quot;, bitmask)</span>
        <span class="c1"># print(&quot;Bitmask_list:&quot;, bitmask_list)</span>
        <span class="c1"># print(&quot;Nums:&quot;, nums)</span>
        <span class="c1"># if len(bitmask_list) &lt; nums:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bitmask_list</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">nums</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">bitmask_list</span><span class="p">[</span><span class="n">nums</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="c1"># filtered = filter_true_indexes(bitmask_list)</span>
    <span class="c1"># for num in nums:</span>
    <span class="c1">#     if num in filtered:</span>
    <span class="c1">#         in_bitmask_dict[num] = True</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         in_bitmask_dict[num] = False</span>

    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bitmask_list</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">in_bitmask_dict</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">in_bitmask_dict</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">in_bitmask_dict</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">in_bitmask_dict</span></div>


<div class="viewcode-block" id="pos"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.pos">[docs]</a><span class="k">def</span> <span class="nf">pos</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple utility function that returns 0 for all input values below 0, or the input value otherwise.</span>

<span class="sd">    :param expr:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">expr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">expr</span></div>


<div class="viewcode-block" id="neg"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.neg">[docs]</a><span class="k">def</span> <span class="nf">neg</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple utility function that returns 0 for all input values above 0, or the input value otherwise.</span>

<span class="sd">    :param expr:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">expr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">expr</span></div>


<div class="viewcode-block" id="print_grid"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.print_grid">[docs]</a><span class="k">def</span> <span class="nf">print_grid</span><span class="p">(</span><span class="n">input_grid</span><span class="p">:</span> <span class="n">Graph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints the current field grid. Empty nodes are represented by spaces, nodes containing players</span>
<span class="sd">    by O&#39;s, and nodes containing enemies by X&#39;s.</span>

<span class="sd">    :param input_grid:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">input_grid</span><span class="o">.</span><span class="n">get_grid_width_height</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">)):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="n">held</span> <span class="o">=</span> <span class="n">input_grid</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">iy</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">ix</span><span class="p">]</span><span class="o">.</span><span class="n">holds</span>
            <span class="k">if</span> <span class="n">held</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;- &quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">held</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">==</span> <span class="n">Enemy</span><span class="p">:</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;X &quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">held</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">==</span> <span class="n">Player</span><span class="p">:</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;O &quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">))</span></div>


<div class="viewcode-block" id="find_inconsistencies"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.find_inconsistencies">[docs]</a><span class="k">def</span> <span class="nf">find_inconsistencies</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function intended to search character data files for skills in incorrect categories.</span>

<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">]:</span>
        <span class="n">skill_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">all_skills</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">temp_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">players_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rarity</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                <span class="n">iskill</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;skills&quot;</span><span class="p">][</span><span class="n">rarity</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">iskill</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">all_skills</span><span class="p">[</span><span class="n">iskill</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">skills_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">iskill</span><span class="p">],</span> <span class="n">key</span><span class="p">)</span>
                    <span class="n">skill_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">skills_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">iskill</span><span class="p">][</span><span class="s2">&quot;category&quot;</span><span class="p">])</span>
                    <span class="n">cat</span> <span class="o">=</span> <span class="n">skill_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">skill_list</span><span class="p">))</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Category is&quot;</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="s2">&quot;for index&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Index&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="s2">&quot;is an aberrant&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Counts:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Cat &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">skill_list</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">skill_list</span><span class="p">)])</span>
            <span class="n">temp_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">skill_list</span><span class="p">)</span>
            <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">skill_list</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">temp_set</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">temp_set</span><span class="p">])}</span>
            <span class="n">wrong_cat</span> <span class="o">=</span> <span class="n">temp_dict</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">temp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wrong cat:&quot;</span><span class="p">,</span> <span class="n">wrong_cat</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">iskill</span><span class="p">,</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">all_skills</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">wrong_cat</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;On hero:&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">players_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;roman&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;)</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;id_tag&quot;</span><span class="p">],</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span>
                          <span class="n">translate_jp_to_en_dict</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">english_data</span><span class="p">,</span> <span class="n">is_skill</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Index&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="s2">&quot;has&quot;</span><span class="p">,</span> <span class="n">temp_set</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>


<span class="c1"># I mean, I suppose the below would work with floats, but floating-point arithmetic can lead to rounding</span>
<span class="c1"># issues and stuff that I don&#39;t feel like dealing with</span>
<div class="viewcode-block" id="ones"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.ones">[docs]</a><span class="k">def</span> <span class="nf">ones</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple utility function to return the one&#39;s place digit of a number.</span>

<span class="sd">    :param x:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">10</span></div>


<div class="viewcode-block" id="tens"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.tens">[docs]</a><span class="k">def</span> <span class="nf">tens</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple utility function to return the ten&#39;s place digit of a number.</span>

<span class="sd">    :param x:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">floor</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span></div>


<div class="viewcode-block" id="hundreds"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.hundreds">[docs]</a><span class="k">def</span> <span class="nf">hundreds</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple utility function to return the hundreds&#39; place digit of a number.</span>

<span class="sd">    :param x:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">floor</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span></div>


<div class="viewcode-block" id="tens_ones"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.tens_ones">[docs]</a><span class="k">def</span> <span class="nf">tens_ones</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple utility function to return a number composed of the one&#39;s and ten&#39;s place digits</span>
<span class="sd">    of the input number.</span>

<span class="sd">    :param x:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">100</span></div>


<span class="c1"># could work with floats, but that&#39;s not what it&#39;s used for here</span>
<div class="viewcode-block" id="in_range"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.in_range">[docs]</a><span class="k">def</span> <span class="nf">in_range</span><span class="p">(</span><span class="n">away</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns boolean denoting whether `away` coordinate is within `distance` spaces of `origin`</span>
<span class="sd">    coordinates or not.</span>

<span class="sd">    :param away:</span>
<span class="sd">    :param origin:</span>
<span class="sd">    :param distance:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">get_distance_from_tuples</span><span class="p">(</span><span class="n">away</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">distance</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span></div>


<span class="n">condition_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;within_range&quot;</span><span class="p">:</span> <span class="s2">&quot;in_range(node.data, origin, distance)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;within_columns&quot;</span><span class="p">:</span> <span class="s2">&quot;in_range((node.data[0], 0), (origin[0], 0), distance)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;within_rows&quot;</span><span class="p">:</span> <span class="s2">&quot;in_range((0, node.data[1]), (0, origin[1]), distance)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;in_cardinals&quot;</span><span class="p">:</span> <span class="s2">&quot;node.data[0] == origin[0] or node.data[1] == origin[1]&quot;</span><span class="p">,</span>
    <span class="s2">&quot;within_area&quot;</span><span class="p">:</span> <span class="s2">&quot;in_range((node.data[0], 0), (origin[0], 0), ones(distance)) and &quot;</span>
                   <span class="s2">&quot;in_range((0, node.data[1]), (0, origin[1]), tens(distance))&quot;</span>
<span class="p">}</span>


<div class="viewcode-block" id="within_range_abstracted"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.within_range_abstracted">[docs]</a><span class="k">def</span> <span class="nf">within_range_abstracted</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">,</span> <span class="n">skill</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Skill</span><span class="p">],</span> <span class="n">condition</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;within_range&quot;</span><span class="p">,</span>
                            <span class="n">grid</span><span class="p">:</span> <span class="n">Graph</span> <span class="o">=</span> <span class="n">GRID</span><span class="p">,</span> <span class="n">distance_override</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Character</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of Character instances whose position is within :attr:`Skill.skill_range`</span>
<span class="sd">    spaces of unit</span>

<span class="sd">    .. note::</span>
<span class="sd">       **Excludes &#39;unit&#39;**</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">within_range_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="n">origin</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">pos</span>
    <span class="c1"># CHECK: Does this always work or should I just use an if statement?</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">distance_override</span> <span class="ow">or</span> <span class="n">skill</span><span class="o">.</span><span class="n">skill_range</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">grid</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="c1"># CHECK: Should this exclude unit?</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">holds</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">holds</span> <span class="o">!=</span> <span class="n">unit</span> <span class="ow">and</span> <span class="nb">eval</span><span class="p">(</span><span class="n">condition_dict</span><span class="p">[</span><span class="n">condition</span><span class="p">]):</span>
            <span class="n">within_range_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">holds</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">within_range_list</span></div>


<span class="n">WITHIN_RANGE_EX_dict</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;within_range&quot;</span><span class="p">,</span>  <span class="c1"># within range distance of unit</span>
                        <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;within_range&quot;</span><span class="p">,</span>  <span class="c1"># same as 0; used by duo skills</span>
                        <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;within_area&quot;</span><span class="p">,</span>  <span class="c1"># within ONES(distance) rows and TENS(distance) columns of unit</span>
                        <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;in_cardinals&quot;</span><span class="p">,</span>  <span class="c1"># in cardinal directions of unit</span>
                        <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;within_columns&quot;</span><span class="p">,</span>  <span class="c1"># within distance columns of unit</span>
                        <span class="mi">5</span><span class="p">:</span> <span class="s2">&quot;within_rows&quot;</span><span class="p">,</span>  <span class="c1"># within distance rows of unit</span>
                        <span class="p">}</span>


<span class="c1"># returns list of characters within range of unit where range is determined by range_shape</span>
<span class="c1"># FIXME: separate range_shape variable not needed? Just use skill.range_shape?</span>
<span class="c1"># Fuck it, I&#39;ll remove it</span>
<span class="c1"># Okay now I&#39;m doing it again but for a different reason</span>
<div class="viewcode-block" id="within_range_ex_abstract"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.within_range_ex_abstract">[docs]</a><span class="k">def</span> <span class="nf">within_range_ex_abstract</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">,</span> <span class="n">skill</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Skill</span><span class="p">],</span> <span class="n">grid</span><span class="p">:</span> <span class="n">Graph</span> <span class="o">=</span> <span class="n">GRID</span><span class="p">,</span>
                             <span class="n">range_shape_override</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">range_shape</span> <span class="o">=</span> <span class="n">range_shape_override</span> <span class="ow">or</span> <span class="n">WITHIN_RANGE_EX_dict</span><span class="p">[</span><span class="n">skill</span><span class="o">.</span><span class="n">range_shape</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">within_range_abstracted</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">skill</span><span class="p">,</span> <span class="n">range_shape</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span></div>


<div class="viewcode-block" id="foes"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.foes">[docs]</a><span class="k">def</span> <span class="nf">foes</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a list of Character objects, &#39;items&#39;, and returns a filtered list containing only characters not</span>
<span class="sd">    on the same team as &#39;unit&#39; (teams are based on the class of &#39;unit&#39;, e.g if &#39;unit&#39; is of class Player, list</span>
<span class="sd">    will be comprised of all non-Player characters in &#39;items&#39;).</span>

<span class="sd">    :param items:</span>
<span class="sd">    :param unit:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ensures unit is a subclass of Character</span>
    <span class="c1"># issubclass(unit.__class__, Character)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">Character</span><span class="p">)</span> <span class="ow">and</span> <span class="n">unit</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">!=</span> <span class="n">Character</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">!=</span> <span class="n">unit</span><span class="o">.</span><span class="vm">__class__</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unit does not belong to a team&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="allies"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.allies">[docs]</a><span class="k">def</span> <span class="nf">allies</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes a list of Character objects, &#39;items&#39;, and returns a filtered list containing only characters</span>
<span class="sd">        on the same team as &#39;unit&#39; (teams are based on the class of &#39;unit&#39;, e.g if &#39;unit&#39; is of class Player,</span>
<span class="sd">        list will be comprised of all Player characters in &#39;items&#39;). Note: the result is inclusive of &#39;unit&#39;</span>
<span class="sd">        in order to keep consistent with the output of the foes() function.</span>

<span class="sd">        :param items:</span>
<span class="sd">        :param unit:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="c1"># ensures unit is a subclass of Character</span>
    <span class="c1"># issubclass(unit.__class__, Character)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">Character</span><span class="p">)</span> <span class="ow">and</span> <span class="n">unit</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">!=</span> <span class="n">Character</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">==</span> <span class="n">unit</span><span class="o">.</span><span class="vm">__class__</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unit does not belong to a team&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_players"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.get_players">[docs]</a><span class="k">def</span> <span class="nf">get_players</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Character</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of all Player instances in char_list</span>

<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">char_list</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">==</span> <span class="n">Player</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_enemies"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.get_enemies">[docs]</a><span class="k">def</span> <span class="nf">get_enemies</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Character</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of all Enemy instances in char_list</span>

<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">char_list</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">==</span> <span class="n">Enemy</span><span class="p">]</span></div>


<div class="viewcode-block" id="hp_between"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.hp_between">[docs]</a><span class="k">def</span> <span class="nf">hp_between</span><span class="p">(</span><span class="n">min_hp_percent</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_hp_percent</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>
    <span class="c1"># TODO: Add current_stats (hp affected by damage, others by chills and visible debuffs)</span>
    <span class="c1"># TODO: Add combat_stats (not full stats, but stat buffs/debuff that should be added to current_stats)</span>

    <span class="k">if</span> <span class="n">min_hp_percent</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">&lt;=</span> <span class="n">unit</span><span class="o">.</span><span class="n">hp</span> <span class="o">/</span> <span class="n">unit</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hp&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">max_hp_percent</span> <span class="o">/</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="mi">0</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="counter"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.counter">[docs]</a><span class="k">def</span> <span class="nf">counter</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unit can counterattack regardless of opponent’s range</span>

<span class="sd">    :param unit:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="no_counter"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.no_counter">[docs]</a><span class="k">def</span> <span class="nf">no_counter</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unit cannot counterattack</span>

<span class="sd">    :param unit:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">no_counter</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="follow_up"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.follow_up">[docs]</a><span class="k">def</span> <span class="nf">follow_up</span><span class="p">(</span><span class="n">follow_up_value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If `follow_up_value` is 1, unit makes a guaranteed follow-up attack, if `follow_up_value` is</span>
<span class="sd">    -1 unit cannot make a follow-up attack.</span>

<span class="sd">    :param follow_up_value: 1 or -1</span>
<span class="sd">    :param unit:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">follow_up</span> <span class="o">+=</span> <span class="n">follow_up_value</span>
    <span class="c1"># FIXME? I think this wrong but idk</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">follow_up_value</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">follow_up_value</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">follow_up_value</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">follow_up_value</span></div>


<span class="c1"># FIXME: This code looks like it can be improved</span>
<div class="viewcode-block" id="null_follow_up"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.null_follow_up">[docs]</a><span class="k">def</span> <span class="nf">null_follow_up</span><span class="p">(</span><span class="n">neut_guarantee_foe</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">neut_prevent_unit</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">,</span> <span class="n">enemy</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">neut_guarantee_foe</span><span class="p">:</span>
        <span class="n">follow_up</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">enemy</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">neut_prevent_unit</span><span class="p">:</span>
        <span class="n">follow_up</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span></div>


<div class="viewcode-block" id="vantage"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.vantage">[docs]</a><span class="k">def</span> <span class="nf">vantage</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unit can counterattack before opponent’s first attack</span>

<span class="sd">    :param unit:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">vantage</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="desperation"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.desperation">[docs]</a><span class="k">def</span> <span class="nf">desperation</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unit can make a follow-up attack before opponent can counterattack</span>

<span class="sd">    :param unit:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">desperation</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="brave"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.brave">[docs]</a><span class="k">def</span> <span class="nf">brave</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unit attacks twice</span>

<span class="sd">    :param unit:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">brave</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="raven"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.raven">[docs]</a><span class="k">def</span> <span class="nf">raven</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Grants weapon-triangle advantage to unit against colorless opponents,</span>
<span class="sd">    and inflicts weapon-triangle disadvantage on colorless opponents during combat.</span>

<span class="sd">    :param unit:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">raven</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="adaptive"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.adaptive">[docs]</a><span class="k">def</span> <span class="nf">adaptive</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates unit’s damage during combat using the lower of opponent’s Def or Res</span>

<span class="sd">    :param unit:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">adaptive</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="adaptive_aoe"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.adaptive_aoe">[docs]</a><span class="k">def</span> <span class="nf">adaptive_aoe</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates damage from unit’s area-of-effect Specials using the lower of opponent’s Def or Res</span>

<span class="sd">    :param unit:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">adaptive_aoe</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="wrathful_staff"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.wrathful_staff">[docs]</a><span class="k">def</span> <span class="nf">wrathful_staff</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates damage from unit’s staff like other weapons</span>

<span class="sd">    :param unit:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">wrathful_staff</span> <span class="o">=</span> <span class="kc">True</span></div>


<span class="c1"># TODO: Add functionality</span>
<div class="viewcode-block" id="charge"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.charge">[docs]</a><span class="k">def</span> <span class="nf">charge</span><span class="p">(</span><span class="n">mode</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">charge_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># grants/inflicts Special cooldown charge +x to/on u per attack during combat</span>

        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># grants/inflicts Special cooldown charge +x to/on u per u’s attack during combat</span>

        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># grants/inflicts Special cooldown charge +x to/on u per opponent of u’s attack during combat</span>

        <span class="k">pass</span>
    <span class="k">pass</span></div>


<span class="c1"># aether/sol/noontime and the like</span>
<div class="viewcode-block" id="combat_add_hp"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.combat_add_hp">[docs]</a><span class="k">def</span> <span class="nf">combat_add_hp</span><span class="p">(</span><span class="n">hp_change</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">hp</span> <span class="o">+=</span> <span class="n">hp_change</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">hp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">hp</span><span class="p">,</span> <span class="n">unit</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hp&quot;</span><span class="p">])</span></div>


<span class="c1"># savage blow and stuff</span>
<div class="viewcode-block" id="map_add_hp"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.map_add_hp">[docs]</a><span class="k">def</span> <span class="nf">map_add_hp</span><span class="p">(</span><span class="n">hp_change</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">):</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">hp</span> <span class="o">+=</span> <span class="n">hp_change</span>
    <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">hp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">unit</span><span class="o">.</span><span class="n">hp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">hp</span><span class="p">,</span> <span class="n">unit</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s2">&quot;hp&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># units cannot be killed by out-of-combat damage</span>
        <span class="n">unit</span><span class="o">.</span><span class="n">hp</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">pass</span></div>


<span class="c1"># Had to use FunctionType because for some reason &#39;function&#39; didn&#39;t work? Gave me an unresolved reference</span>
<span class="c1"># Screw it, I don&#39;t like FunctionType</span>
<span class="c1"># Actually, Callable is a function, not a type</span>
<span class="c1"># Hmmmmmmmmmmmmmmmmmmm</span>
<div class="viewcode-block" id="count_around"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.count_around">[docs]</a><span class="k">def</span> <span class="nf">count_around</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">,</span> <span class="n">unit_type</span><span class="p">:</span> <span class="s1">&#39;Callable&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s1">&#39;Slid&#39;</span><span class="p">,</span> <span class="s1">&#39;Skill&#39;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="c1"># FIXME: Improve docstring</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If context is:</span>
<span class="sd">        SkillLimit (Slid instance):</span>
<span class="sd">            returns the number of &#39;unit_type&#39; within param1 spaces of &#39;unit&#39; (excluding &#39;unit&#39;)</span>
<span class="sd">        SkillAbility (Skill instance):</span>
<span class="sd">            returns the number of &#39;unit_type&#39; within skill_range spaces of &#39;unit&#39; (excluding &#39;unit&#39;)</span>

<span class="sd">    :param unit: Unit to use as origin</span>
<span class="sd">    :param unit_type: Condition to evaluate</span>
<span class="sd">    :param context: Context function is being used in</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># FIXME: Improve context variable, it&#39;s terrible right now and the error string is just plain confusing</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">Slid</span><span class="p">):</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">param1</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">Skill</span><span class="p">):</span>
        <span class="nb">range</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">skill_range</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Context can be either &#39;limit&#39; (Slid instance) or &#39;ability&#39; (Skill instance), &quot;</span>
                         <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> was supplied&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>

    <span class="c1"># FIXME: Combine the below lines after testing</span>
    <span class="c1"># within_range doesn&#39;t return unit so that means count_around doesn&#39;t either</span>
    <span class="n">char_around</span> <span class="o">=</span> <span class="n">within_range_abstracted</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;within_range&quot;</span><span class="p">,</span> <span class="n">distance_override</span><span class="o">=</span><span class="nb">range</span><span class="p">)</span>

    <span class="c1"># filters nearby characters by &#39;unit_type&#39; condition</span>
    <span class="n">cond_char</span> <span class="o">=</span> <span class="n">unit_type</span><span class="p">(</span><span class="n">char_around</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>

    <span class="c1"># returns number of nearby characters that satisfy condition</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">cond_char</span><span class="p">)</span></div>


<span class="c1"># could implement using within_range, but I think this is better</span>
<span class="c1"># CHECK: This thing is confusing</span>
<div class="viewcode-block" id="unit_near"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.unit_near">[docs]</a><span class="k">def</span> <span class="nf">unit_near</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_unit</span><span class="p">:</span> <span class="s1">&#39;Character&#39;</span><span class="p">,</span> <span class="n">skill</span><span class="p">:</span> <span class="n">Skill</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If unit is :func:`within_range` of unit</span>

<span class="sd">    :param self:</span>
<span class="sd">    :param other_unit:</span>
<span class="sd">    :param skill:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">in_range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">other_unit</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">skill</span><span class="o">.</span><span class="n">skill_range</span><span class="p">)</span></div>


<div class="viewcode-block" id="neighborhood"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.neighborhood">[docs]</a><span class="k">def</span> <span class="nf">neighborhood</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">,</span> <span class="n">skill</span><span class="p">:</span> <span class="n">Skill</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Character</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unit and units on unit’s team :func:`within_range` of unit</span>

<span class="sd">    :param unit:</span>
<span class="sd">    :param skill:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nearby</span> <span class="o">=</span> <span class="n">within_range_abstracted</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">skill</span><span class="p">,</span> <span class="s2">&quot;within_range&quot;</span><span class="p">)</span>

    <span class="c1"># second part is not needed because allies() is inclusive</span>
    <span class="k">return</span> <span class="n">allies</span><span class="p">(</span><span class="n">nearby</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>  <span class="c1"># + [unit]</span></div>


<div class="viewcode-block" id="neighborhood_ex"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.neighborhood_ex">[docs]</a><span class="k">def</span> <span class="nf">neighborhood_ex</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">,</span> <span class="n">skill</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Skill</span><span class="p">],</span> <span class="n">range_shape_override</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Character</span><span class="p">]:</span>
    <span class="n">nearby</span> <span class="o">=</span> <span class="n">within_range_ex_abstract</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">skill</span><span class="p">,</span> <span class="n">range_shape_override</span><span class="o">=</span><span class="n">range_shape_override</span><span class="p">)</span>

    <span class="c1"># second part is not needed because allies() is inclusive</span>
    <span class="k">return</span> <span class="n">allies</span><span class="p">(</span><span class="n">nearby</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>  <span class="c1"># + [unit]</span></div>


<div class="viewcode-block" id="cooldown"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.cooldown">[docs]</a><span class="k">def</span> <span class="nf">cooldown</span><span class="p">(</span><span class="n">cooldown</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">special_cd</span> <span class="o">+=</span> <span class="n">cooldown</span>

    <span class="c1"># if special_cd is below 0, set to 0</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">special_cd</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">unit</span><span class="o">.</span><span class="n">special_cd</span><span class="p">)</span>
    <span class="c1"># if special_cd is above max, set to max</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">special_cd</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">special_cd</span><span class="p">,</span> <span class="n">unit</span><span class="o">.</span><span class="n">max_special_cd</span><span class="p">)</span></div>


<div class="viewcode-block" id="buff"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.buff">[docs]</a><span class="k">def</span> <span class="nf">buff</span><span class="p">(</span><span class="n">skill</span><span class="p">:</span> <span class="n">Skill</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Character</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Character</span><span class="p">]]):</span>
    <span class="c1"># TODO: Make compatible with buffs and debuffs, add checks to only increase if greater than current buff</span>
    <span class="c1"># TODO: Buffs last for 1 turn, debuffs last through next action</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">skill</span><span class="o">.</span><span class="n">skill_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">unit</span><span class="o">.</span><span class="n">buffs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">skill_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>


<div class="viewcode-block" id="buff2"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.buff2">[docs]</a><span class="k">def</span> <span class="nf">buff2</span><span class="p">(</span><span class="n">skill</span><span class="p">:</span> <span class="n">Skill</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Character</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Character</span><span class="p">]]):</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">skill</span><span class="o">.</span><span class="n">skill_params2</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">unit</span><span class="o">.</span><span class="n">buffs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">skill_params2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>


<span class="n">status_dict</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;Gravity&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;Panic&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;No counterattacks&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;March&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;Triangle Adept&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="s2">&quot;Guard&quot;</span><span class="p">,</span>
               <span class="mi">6</span><span class="p">:</span> <span class="s2">&quot;Air Orders&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="s2">&quot;Isolation&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="s2">&quot;Effective against dragons&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span> <span class="s2">&quot;Bonus doubler&quot;</span><span class="p">,</span>
               <span class="mi">10</span><span class="p">:</span> <span class="s2">&quot;Dragon shield&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">:</span> <span class="s2">&quot;Svalinn shield&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span> <span class="s2">&quot;Dominance&quot;</span><span class="p">,</span> <span class="mi">13</span><span class="p">:</span> <span class="s2">&quot;Resonance: Blades&quot;</span><span class="p">,</span> <span class="mi">14</span><span class="p">:</span> <span class="s2">&quot;Desperation&quot;</span><span class="p">}</span>


<div class="viewcode-block" id="status"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.status">[docs]</a><span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="n">status_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts status id to status name</span>

<span class="sd">    :param status_id:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">status_dict</span><span class="p">[</span><span class="n">status_id</span><span class="p">]</span></div>


<div class="viewcode-block" id="add_status"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.add_status">[docs]</a><span class="k">def</span> <span class="nf">add_status</span><span class="p">(</span><span class="n">status_effect</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Grants/inflicts status to/on unit</span>

<span class="sd">    :param status_effect:</span>
<span class="sd">    :param unit:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit</span><span class="o">.</span><span class="n">status_effects</span><span class="p">[</span><span class="n">status_effect</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="special_damage"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.special_damage">[docs]</a><span class="k">def</span> <span class="nf">special_damage</span><span class="p">(</span><span class="n">damage</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="luna"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.luna">[docs]</a><span class="k">def</span> <span class="nf">luna</span><span class="p">(</span><span class="n">reduction_percent</span><span class="p">):</span>
    <span class="k">pass</span></div>


<span class="c1"># TODO: Write the logic for these</span>
<div class="viewcode-block" id="bonus_broad"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.bonus_broad">[docs]</a><span class="k">def</span> <span class="nf">bonus_broad</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>
    <span class="c1"># do calculations here</span>

    <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="bonus_narrow"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.bonus_narrow">[docs]</a><span class="k">def</span> <span class="nf">bonus_narrow</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">buff_total</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="penalty_broad"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.penalty_broad">[docs]</a><span class="k">def</span> <span class="nf">penalty_broad</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>
    <span class="c1"># same as above, but reversed</span>

    <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="penalty_narrow"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.penalty_narrow">[docs]</a><span class="k">def</span> <span class="nf">penalty_narrow</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="dragon"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.dragon">[docs]</a><span class="k">def</span> <span class="nf">dragon</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Character</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Character</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="mi">16</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="o">.</span><span class="n">weapon_type</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">]</span></div>


<div class="viewcode-block" id="beast"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.beast">[docs]</a><span class="k">def</span> <span class="nf">beast</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Character</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Character</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="mi">20</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="o">.</span><span class="n">weapon_type</span> <span class="o">&lt;</span> <span class="mi">24</span><span class="p">]</span></div>


<div class="viewcode-block" id="not_dragon"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.not_dragon">[docs]</a><span class="k">def</span> <span class="nf">not_dragon</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Character</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Character</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="ow">not</span> <span class="mi">16</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="o">.</span><span class="n">weapon_type</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">]</span></div>


<div class="viewcode-block" id="not_beast"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.not_beast">[docs]</a><span class="k">def</span> <span class="nf">not_beast</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Character</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Character</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="ow">not</span> <span class="mi">20</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="o">.</span><span class="n">weapon_type</span> <span class="o">&lt;</span> <span class="mi">24</span><span class="p">]</span></div>


<div class="viewcode-block" id="combine_buffs_debuffs"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.combine_buffs_debuffs">[docs]</a><span class="k">def</span> <span class="nf">combine_buffs_debuffs</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>
    <span class="c1"># Could also do this, more human, {stat: unit.buffs[stat] + unit.debuffs[stat] for stat in unit.stats}</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">stat</span><span class="p">:</span> <span class="n">buff</span> <span class="o">+</span> <span class="n">unit</span><span class="o">.</span><span class="n">debuffs</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="k">for</span> <span class="n">stat</span><span class="p">,</span> <span class="n">buff</span> <span class="ow">in</span> <span class="n">unit</span><span class="o">.</span><span class="n">buffs</span><span class="p">}</span></div>


<div class="viewcode-block" id="buff_total"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.buff_total">[docs]</a><span class="k">def</span> <span class="nf">buff_total</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">buffs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></div>


<div class="viewcode-block" id="debuff_total"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.debuff_total">[docs]</a><span class="k">def</span> <span class="nf">debuff_total</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">debuffs</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span></div>


<div class="viewcode-block" id="get_direction"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.get_direction">[docs]</a><span class="k">def</span> <span class="nf">get_direction</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Character</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">],</span> <span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Character</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">Character</span><span class="p">):</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">pos</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">unit</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Character</span><span class="p">):</span>
        <span class="n">second</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">pos</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">second</span> <span class="o">=</span> <span class="n">target</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span>

    <span class="k">if</span> <span class="n">get_distance_from_tuples</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Positions are not adjacent, thus direction is not cardinal&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">get_distance_from_tuples</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;First and second positions must be different&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">first</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">second</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">first</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">second</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">first</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">second</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="give_action"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.give_action">[docs]</a><span class="k">def</span> <span class="nf">give_action</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>
    <span class="k">pass</span></div>


<span class="c1"># CHECK: is this how it should be done? Should I keep debuff values for future reference?</span>
<div class="viewcode-block" id="convert_penalties_to_bonuses"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.convert_penalties_to_bonuses">[docs]</a><span class="k">def</span> <span class="nf">convert_penalties_to_bonuses</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">unit</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">unit</span><span class="o">.</span><span class="n">buffs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">debuffs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">unit</span><span class="o">.</span><span class="n">debuffs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>


<span class="c1"># CHECK: is this how it should be done? Should I keep buff values for future reference?</span>
<div class="viewcode-block" id="convert_bonuses_to_penalties"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.convert_bonuses_to_penalties">[docs]</a><span class="k">def</span> <span class="nf">convert_bonuses_to_penalties</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">unit</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">unit</span><span class="o">.</span><span class="n">debuffs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">buffs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">unit</span><span class="o">.</span><span class="n">buffs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="neutralize_penalties"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.neutralize_penalties">[docs]</a><span class="k">def</span> <span class="nf">neutralize_penalties</span><span class="p">(</span><span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>
    <span class="c1"># TODO: Neutralize penalties on unit</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="spectrum_buff"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.spectrum_buff">[docs]</a><span class="k">def</span> <span class="nf">spectrum_buff</span><span class="p">(</span><span class="n">units</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Character</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Character</span><span class="p">]],</span> <span class="n">buff</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">units</span><span class="p">),</span> <span class="n">Iterable</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">Character</span><span class="p">):</span>
        <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="n">units</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input must be a Character type or an Iterable containing Character types&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;atk&quot;</span><span class="p">,</span> <span class="s2">&quot;spd&quot;</span><span class="p">,</span> <span class="s2">&quot;def&quot;</span><span class="p">,</span> <span class="s2">&quot;res&quot;</span><span class="p">]:</span>
            <span class="n">unit</span><span class="o">.</span><span class="n">buffs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">buffs</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">buff</span><span class="p">)</span></div>


<div class="viewcode-block" id="spectrum_debuff"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.spectrum_debuff">[docs]</a><span class="k">def</span> <span class="nf">spectrum_debuff</span><span class="p">(</span><span class="n">units</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Character</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Character</span><span class="p">]],</span> <span class="n">debuff</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">units</span><span class="p">),</span> <span class="n">Iterable</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">Character</span><span class="p">):</span>
        <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="n">units</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input must be a Character type or an Iterable containing Character types&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;atk&quot;</span><span class="p">,</span> <span class="s2">&quot;spd&quot;</span><span class="p">,</span> <span class="s2">&quot;def&quot;</span><span class="p">,</span> <span class="s2">&quot;res&quot;</span><span class="p">]:</span>
            <span class="n">unit</span><span class="o">.</span><span class="n">debuffs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">debuffs</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">debuff</span><span class="p">)</span></div>


<span class="c1"># ==============</span>

<div class="viewcode-block" id="Slid"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.Slid">[docs]</a><span class="k">class</span> <span class="nc">Slid</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Creates self.param1 and self.param2&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skill</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skill</span> <span class="o">=</span> <span class="n">skill</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param1</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">limit1_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param2</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">limit1_params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param1</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">limit2_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param2</span> <span class="o">=</span> <span class="n">skill</span><span class="o">.</span><span class="n">limit2_params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="find"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.find">[docs]</a><span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">slid_value</span><span class="p">):</span>
    <span class="c1"># finds id with matching value and returns Slid object</span>
    <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">id_value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">skill</span><span class="o">.</span><span class="n">limit1_id</span><span class="p">,</span> <span class="n">skill</span><span class="o">.</span><span class="n">limit2_id</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">id_value</span> <span class="o">==</span> <span class="n">slid_value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Slid</span><span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="nb">id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">LimitIdNotFound</span><span class="p">(</span><span class="s2">&quot;Search for slid</span><span class="si">{0}</span><span class="s2"> did not yield any results&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slid_value</span><span class="p">))</span></div>
    <span class="c1"># return -1</span>


<span class="c1"># GENERAL DEFINITIONS END</span>
<span class="c1"># ============================================================================================================</span>


<div class="viewcode-block" id="GameLoop"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop">[docs]</a><span class="k">class</span> <span class="nc">GameLoop</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">turn</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># 1?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="s2">&quot;player&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span>

    <span class="nd">@phase</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">turn</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="GameLoop.main"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.main">[docs]</a>    <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">autobattle</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="c1"># self.swap_phase()</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="c1"># self.player_phase()</span>
            <span class="c1"># self.enemy_phase()</span>
            <span class="c1">#</span>
            <span class="c1"># instruction = input()</span>
            <span class="c1"># self.process_instruction(instruction)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">battle_phase</span><span class="p">()</span></div>

<div class="viewcode-block" id="GameLoop.process_instruction"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.process_instruction">[docs]</a>    <span class="k">def</span> <span class="nf">process_instruction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruction</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">tokens</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">instruction</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;chars&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Player characters:&quot;</span><span class="p">)</span>
            <span class="n">players</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">char_list</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">==</span> <span class="n">Player</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">players</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">players</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Enemy characters:&quot;</span><span class="p">)</span>
            <span class="n">enemies</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">char_list</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">==</span> <span class="n">Enemy</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enemies</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">enemies</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;create&quot;</span><span class="p">:</span>
            <span class="n">char_type</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>


        <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;exit&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such command, attempting exec&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">exec</span><span class="p">(</span><span class="n">instruction</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed exec: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="GameLoop.swap_phase"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.swap_phase">[docs]</a>    <span class="k">def</span> <span class="nf">swap_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting swap phase&quot;</span><span class="p">)</span>

        <span class="c1"># do something</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">battle_phase</span><span class="p">()</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="GameLoop.player_phase"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.player_phase">[docs]</a>    <span class="k">def</span> <span class="nf">player_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting player phase&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="s2">&quot;player&quot;</span>
        <span class="n">players</span> <span class="o">=</span> <span class="n">get_players</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_of_turn</span><span class="p">(</span><span class="n">players</span><span class="p">)</span>

        <span class="n">print_grid</span><span class="p">(</span><span class="n">GRID</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">player</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">player</span><span class="o">.</span><span class="n">pos</span><span class="si">}</span><span class="s2">;&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">player</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">players</span><span class="p">)])</span>
        <span class="c1"># print(*[f&quot;{enemy.name} {enemy.pos};&quot; for enemy in get_enemies()])</span>

        <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select unit: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">action</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Select action move (m) or attack (a): &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Give enemy position: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">players</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">attack_node</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Give position to move to: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">players</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span></div>

<div class="viewcode-block" id="GameLoop.enemy_phase"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.enemy_phase">[docs]</a>    <span class="k">def</span> <span class="nf">enemy_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting enemy phase&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="s2">&quot;enemy&quot;</span>
        <span class="n">enemies</span> <span class="o">=</span> <span class="n">get_enemies</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_of_turn</span><span class="p">(</span><span class="n">enemies</span><span class="p">)</span></div>

<div class="viewcode-block" id="GameLoop.get_phase"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.get_phase">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ph</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">player_phase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enemy_phase</span><span class="p">]:</span>
                <span class="k">yield</span> <span class="n">ph</span></div>

<div class="viewcode-block" id="GameLoop.battle_phase"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.battle_phase">[docs]</a>    <span class="k">def</span> <span class="nf">battle_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting battle phase&quot;</span><span class="p">)</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="n">get_players</span><span class="p">()</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">or</span> <span class="n">get_enemies</span><span class="p">()</span> <span class="o">==</span> <span class="p">[]):</span>
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">))()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">==</span> <span class="s2">&quot;player&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Victory&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">==</span> <span class="s2">&quot;enemy&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Defeat&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="GameLoop.evaluate_skills"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.evaluate_skills">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate_skills</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">characters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Character</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Character</span><span class="p">]],</span>
                        <span class="n">timing_contexts</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">characters</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
            <span class="n">characters</span> <span class="o">=</span> <span class="p">[</span><span class="n">characters</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="n">characters</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">character</span><span class="p">,</span> <span class="n">Character</span><span class="p">)</span>

            <span class="c1"># TODO: Determine SAID order</span>
            <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">skill</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="n">character</span><span class="o">.</span><span class="n">equipped_skills</span><span class="p">,</span> <span class="n">weapon</span><span class="o">=</span><span class="n">character</span><span class="o">.</span><span class="n">weapon</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">skill</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">Skill</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">skill</span><span class="o">.</span><span class="n">timing_id</span> <span class="ow">in</span> <span class="n">timing_contexts</span><span class="p">:</span>
                        <span class="c1"># do skill stuff here; skill.activate() or whatever</span>
                        <span class="c1"># I have indeed made it be &quot;skill.activate() or whatever&quot;</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Activating </span><span class="si">{</span><span class="n">skill</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">skill</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">skill</span><span class="o">=</span><span class="n">skill</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">character</span><span class="p">)</span>

                        <span class="c1"># CHECK: Change to evaluate for each SAID rather than each character here?</span>

                        <span class="k">pass</span></div>

    <span class="c1"># CHECK: All of the below</span>

<div class="viewcode-block" id="GameLoop.start_of_turn"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.start_of_turn">[docs]</a>    <span class="k">def</span> <span class="nf">start_of_turn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">characters</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting turn&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_skills</span><span class="p">(</span><span class="n">characters</span><span class="p">,</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">27</span><span class="p">])</span></div>

<div class="viewcode-block" id="GameLoop.upon_movement"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.upon_movement">[docs]</a>    <span class="k">def</span> <span class="nf">upon_movement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_skills</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">26</span><span class="p">])</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="GameLoop.after_movement"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.after_movement">[docs]</a>    <span class="k">def</span> <span class="nf">after_movement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_skills</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="p">[</span><span class="mi">19</span><span class="p">])</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="GameLoop.before_combat"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.before_combat">[docs]</a>    <span class="k">def</span> <span class="nf">before_combat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">,</span> <span class="n">foe</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_skills</span><span class="p">([</span><span class="n">unit</span><span class="p">,</span> <span class="n">foe</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">28</span><span class="p">])</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="GameLoop.during_combat"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.during_combat">[docs]</a>    <span class="k">def</span> <span class="nf">during_combat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">,</span> <span class="n">foe</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_skills</span><span class="p">([</span><span class="n">unit</span><span class="p">,</span> <span class="n">foe</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">28</span><span class="p">])</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="GameLoop.after_combat"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.after_combat">[docs]</a>    <span class="k">def</span> <span class="nf">after_combat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">,</span> <span class="n">foe</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_skills</span><span class="p">([</span><span class="n">unit</span><span class="p">,</span> <span class="n">foe</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">27</span><span class="p">])</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="GameLoop.attack"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.attack">[docs]</a>    <span class="k">def</span> <span class="nf">attack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">,</span> <span class="n">foe</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_skills</span><span class="p">([</span><span class="n">unit</span><span class="p">,</span> <span class="n">foe</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">])</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="GameLoop.use_assist"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.use_assist">[docs]</a>    <span class="k">def</span> <span class="nf">use_assist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_skills</span><span class="p">([</span><span class="n">unit</span><span class="p">,</span> <span class="n">target</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">])</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="GameLoop.use_duo_skill"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.use_duo_skill">[docs]</a>    <span class="k">def</span> <span class="nf">use_duo_skill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">Character</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_skills</span><span class="p">([</span><span class="n">unit</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="GameLoop.calc_arena_score"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.GameLoop.calc_arena_score">[docs]</a>    <span class="k">def</span> <span class="nf">calc_arena_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">characters</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_skills</span><span class="p">(</span><span class="n">characters</span><span class="p">,</span> <span class="p">[</span><span class="mi">18</span><span class="p">])</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="program_instructions"><a class="viewcode-back" href="../FireEmblemCombatV2.html#FireEmblemCombatV2.program_instructions">[docs]</a><span class="k">def</span> <span class="nf">program_instructions</span><span class="p">():</span>
    <span class="c1"># testchar = Character.from_dict(players_data[0][&quot;PID_Clarisse&quot;], weapon=&quot;SID_鉄の弓&quot;, pos=(1, 1))</span>
    <span class="c1"># print(testchar.stats)</span>
    <span class="c1"># testchar.unequip_weapon()</span>
    <span class="c1"># print(testchar.stats)</span>
    <span class="c1"># testchar.equip_weapon(&quot;SID_狙撃手の弓&quot;)</span>
    <span class="c1"># print(testchar.stats)</span>
    <span class="c1">#</span>
    <span class="c1"># gl = GameLoop()</span>
    <span class="c1"># gl.main()</span>
    <span class="kn">from</span> <span class="nn">Code.FEH_character_search</span> <span class="kn">import</span> <span class="n">get_character</span>

    <span class="n">testchar</span> <span class="o">=</span> <span class="n">Enemy</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">players_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">get_character</span><span class="p">(</span><span class="s2">&quot;Aversa&quot;</span><span class="p">,</span> <span class="n">players_data</span><span class="p">)],</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                               <span class="n">rarity</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">weapon</span><span class="o">=</span><span class="s2">&quot;SID_ノスフェラート&quot;</span><span class="p">)</span>

    <span class="n">testchar2</span> <span class="o">=</span> <span class="n">Player</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">players_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">get_character</span><span class="p">(</span><span class="s2">&quot;Alphonse&quot;</span><span class="p">,</span> <span class="n">players_data</span><span class="p">)],</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rarity</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                 <span class="n">level</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
                                 <span class="n">weapon</span><span class="o">=</span><span class="s2">&quot;SID_銀の剣&quot;</span><span class="p">)</span>

    <span class="n">testchar3</span> <span class="o">=</span> <span class="n">Player</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">players_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">get_character</span><span class="p">(</span><span class="s2">&quot;Alphonse&quot;</span><span class="p">,</span> <span class="n">players_data</span><span class="p">)],</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rarity</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                 <span class="n">level</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
                                 <span class="n">weapon</span><span class="o">=</span><span class="s2">&quot;SID_銀の剣&quot;</span><span class="p">)</span>

    <span class="c1"># print(&quot;STATS:&quot;, players_data[0][&quot;PID_Ophelia&quot;][&quot;base_stats&quot;])</span>
    <span class="c1"># print()</span>
    <span class="c1"># testchar2 = Player.from_dict(players_data[0][&quot;PID_Ophelia&quot;], pos=(2, 1), rarity=5, level=40,</span>
    <span class="c1">#                              weapon=&quot;SID_魔書ミステルトィン&quot;, special_cd=4, max_special_cd=4)</span>
    <span class="c1"># print()</span>
    <span class="c1"># testchar3 = Player.from_dict(players_data[0][&quot;PID_Ophelia&quot;], pos=(3, 1), rarity=5, level=40,</span>
    <span class="c1">#                              weapon=&quot;SID_魔書ミステルトィン&quot;, special_cd=4, max_special_cd=4)</span>
    <span class="c1"># print()</span>
    <span class="c1"># print(&quot;STATS&quot;, players_data[0][&quot;PID_Ophelia&quot;][&quot;base_stats&quot;])</span>

    <span class="n">loop</span> <span class="o">=</span> <span class="n">GameLoop</span><span class="p">()</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>

    <span class="c1"># for skill in skills_data[1].values():</span>
    <span class="c1">#     if skill[&quot;timing_id&quot;] == 8 and (skill[&quot;limit1_id&quot;] == 9 or skill[&quot;limit2_id&quot;] == 9):</span>
    <span class="c1">#         print(skill)</span>

    <span class="c1"># for skill in skills_data[1].values():</span>
    <span class="c1">#     # slid0 means the skill does not have an activation condition</span>
    <span class="c1">#     if (skill[&quot;limit1_id&quot;] == skill[&quot;limit2_id&quot;]) and (skill[&quot;limit1_id&quot;] != 0 and skill[&quot;limit2_id&quot;] != 0):</span>
    <span class="c1">#         print(skill)</span>

    <span class="c1"># x = Skill.from_dict(skills_data[0][&quot;Desperation 3&quot;])</span>
    <span class="c1"># with stid1.SLID(x, testchar) as sl:</span>
    <span class="c1">#     print(sl.__dict__)</span>

    <span class="c1"># print(len(players_data[0]))</span>
    <span class="c1"># data0 = {v[&quot;id_num&quot;] for k, v in players_data[0].items()}</span>
    <span class="c1"># print(len(players_data[1]))</span>
    <span class="c1"># data1 = {v[&quot;id_num&quot;] for k, v in players_data[1].items()}</span>
    <span class="c1"># print(data1.symmetric_difference(data0))</span>
    <span class="c1"># print(len(players_data[2]))</span>

    <span class="k">pass</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># load all necessary data</span>
    <span class="n">skills_data</span><span class="p">,</span> <span class="n">players_data</span><span class="p">,</span> <span class="n">enemies_data</span><span class="p">,</span> <span class="n">weapons_data</span><span class="p">,</span> <span class="n">english_data</span><span class="p">,</span> <span class="n">growth_data</span><span class="p">,</span> <span class="n">move_data</span><span class="p">,</span> \
    <span class="n">stage_encount_data</span><span class="p">,</span> <span class="n">terrain_data</span> <span class="o">=</span> <span class="n">load_files</span><span class="p">(</span><span class="n">get_simple_names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">weapon_data_by_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">weapons_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span>

    <span class="n">colors_by_weapon_index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">weapon_index_to_color_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">)],</span> <span class="n">colors_by_weapon_index</span><span class="p">)}</span>

    <span class="c1"># from Code.SkillTimingContexts import (</span>
    <span class="c1">#     stid0, stid1, stid2, stid3, stid4, stid5, stid6, stid7, stid8, stid9, stid10,</span>
    <span class="c1">#     stid11, stid12, stid13, stid14, stid15, stid16, stid17, stid18, stid19, stid20,</span>
    <span class="c1">#     stid21, stid22, stid23, stid24, stid25, stid26, stid27, stid28</span>
    <span class="c1"># )</span>

    <span class="kn">from</span> <span class="nn">Code.SkillTimingContexts</span> <span class="kn">import</span> <span class="o">*</span>

    <span class="c1"># ========================================================================================================</span>

    <span class="n">prog_start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="n">program_instructions</span><span class="p">()</span>
    <span class="n">prog_stop</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Time elapsed:&quot;</span><span class="p">,</span> <span class="n">prog_stop</span> <span class="o">-</span> <span class="n">prog_start</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Program execution complete; terminating process&quot;</span><span class="p">)</span>

<span class="c1"># TODO: Add getter/setter properties for unit attributes like hp that trigger on_damage(), check_is_dead(), etc</span>

<span class="c1"># TODO: Add __slots__ that is initialized at runtime to the values retrieved from the json files + predefined</span>

<span class="c1"># TODO Final Boss: Finish this</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Dania M.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>